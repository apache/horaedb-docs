<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=cn class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://horaedb.apache.org/cn/docs/user-guide/sql/><link rel=alternate type=application/rss+xml href=https://horaedb.apache.org/cn/docs/user-guide/sql/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>SQL 语法 | Apache HoraeDB</title>
<meta name=description content="本章介绍 HoraeDB 的 SQL 使用语法。"><meta property="og:url" content="https://horaedb.apache.org/cn/docs/user-guide/sql/"><meta property="og:site_name" content="Apache HoraeDB"><meta property="og:title" content="SQL 语法"><meta property="og:description" content="本章介绍 HoraeDB 的 SQL 使用语法。"><meta property="og:locale" content="cn"><meta property="og:type" content="website"><meta itemprop=name content="SQL 语法"><meta itemprop=description content="本章介绍 HoraeDB 的 SQL 使用语法。"><meta itemprop=dateModified content="2024-08-21T10:34:40+08:00"><meta itemprop=wordCount content="5"><meta name=twitter:card content="summary"><meta name=twitter:title content="SQL 语法"><meta name=twitter:description content="本章介绍 HoraeDB 的 SQL 使用语法。"><link rel=preload href=/scss/main.min.5e43f8574351718e9b44966c9f3a571202ed048c082f457fb574c10b1a1bc56c.css as=style integrity="sha256-XkP4V0NRcY6bRJZsnzpXEgLtBIwIL0V/tXTBCxobxWw=" crossorigin=anonymous><link href=/scss/main.min.5e43f8574351718e9b44966c9f3a571202ed048c082f457fb574c10b1a1bc56c.css rel=stylesheet integrity="sha256-XkP4V0NRcY6bRJZsnzpXEgLtBIwIL0V/tXTBCxobxWw=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/cn/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Apache HoraeDB</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class="nav-link active" href=/cn/docs/><i class='fa-solid fa-book'></i><span>文档</span></a></li><li class=nav-item><a class=nav-link href=/cn/downloads/><i class='fa-solid fa-download'></i><span>下载</span></a></li><li class=nav-item><a class=nav-link href=/cn/blog/><i class='fa-brands fa-blogger'></i><span>博客</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>中文</a><ul class=dropdown-menu><li><a class=dropdown-item href=/docs/user-guide/sql/>English</a></li></ul></div></li><li class="td-light-dark-menu nav-item dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown data-bs-display=static aria-label="Toggle theme (auto)"><svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=bd-theme-text><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.c4e952891b598d25b3097b7e53c54c01.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/cn/docs/user-guide/sql/>Return to the regular view of this page</a>.</p></div><h1 class=title>SQL 语法</h1><ul><li>1: <a href=#pg-b44ac2bc6defc768462e155ee00151eb>数据模型</a></li><ul><li>1.1: <a href=#pg-74978ec47e9ec45be0829b82a6a1cad7>数据类型</a></li><li>1.2: <a href=#pg-84266c71d3220e01f99899ea692d4688>特殊字段</a></li></ul><li>2: <a href=#pg-7d861cbbbb946005aa361b47211951d3>标识符</a></li><li>3: <a href=#pg-a56eddbde23fb9aec1ef2f67e7dfaec3>表结构操作</a></li><ul><li>3.1: <a href=#pg-68dd845e51ad6e6c2c8d0e90d0386830>ALTER TABLE</a></li><li>3.2: <a href=#pg-5f7ab6b13fb6fbd5ae2e2ca6e05687fd>DROP TABLE</a></li><li>3.3: <a href=#pg-6d8b07bab2bfacd40385ad0d54b7f17c>创建表</a></li></ul><li>4: <a href=#pg-bc38c5a475ad6316c41c4e31be03630d>数据操作</a></li><ul><li>4.1: <a href=#pg-55eb2b9d918713a31388dd5e355f569d>INSERT</a></li><li>4.2: <a href=#pg-ae9a3b5e9aba5151ee26972acc9f7e2e>SELECT</a></li></ul><li>5: <a href=#pg-b503efb26df2941b96a344484d6a91a2>常用 SQL</a></li><li>6: <a href=#pg-6eb5d8309a31ca1c8c3311aae4346b17>配置项</a></li><li>7: <a href=#pg-0ef89f21a5acc9b299f40523cb5ab1f8>标量函数</a></li><li>8: <a href=#pg-efa48a3298c70ae47edb1fd4b128cd3e>聚合函数</a></li></ul><div class=content><p>本章介绍 HoraeDB 的 SQL 使用语法。</p></div></div><div class=td-content><h1 id=pg-b44ac2bc6defc768462e155ee00151eb>1 - 数据模型</h1><p>本章介绍 HoraeDB 的数据模型。</p></div><div class=td-content><h1 id=pg-74978ec47e9ec45be0829b82a6a1cad7>1.1 - 数据类型</h1><p>HoraeDB 实现了 <code>Table</code> 模型，支持的数据类型和 MySQL 比较类似。
下列表格列出了 HoraeDB 的数据类型和 MySQL 的数据类型的对应关系。</p><h2 id=支持的数据类型-大小写不敏感>支持的数据类型 (大小写不敏感)</h2><table><thead><tr><th>SQL</th><th>HoraeDB</th></tr></thead><tbody><tr><td>null</td><td>Null</td></tr><tr><td>timestamp</td><td>Timestamp</td></tr><tr><td>double</td><td>Double</td></tr><tr><td>float</td><td>Float</td></tr><tr><td>string</td><td>String</td></tr><tr><td>Varbinary</td><td>Varbinary</td></tr><tr><td>uint64</td><td>UInt64</td></tr><tr><td>uint32</td><td>UInt32</td></tr><tr><td>uint16</td><td>UInt16</td></tr><tr><td>uint8</td><td>UInt8</td></tr><tr><td>int64/bigint</td><td>Int64</td></tr><tr><td>int32/int</td><td>Int32</td></tr><tr><td>int16/smallint</td><td>Int16</td></tr><tr><td>int8/tinyint</td><td>Int8</td></tr><tr><td>boolean</td><td>Boolean</td></tr><tr><td>date</td><td>Date</td></tr><tr><td>time</td><td>Time</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-84266c71d3220e01f99899ea692d4688>1.2 - 特殊字段</h1><p>HoraeDB 的表的约束如下：</p><ul><li>必须有主键</li><li>主键必须包含时间列，并且只能包含一个时间列</li><li>主键不可为空，并且主键的组成字段也不可为空</li></ul><h2 id=timestamp-列>Timestamp 列</h2><p>HoraeDB 的表必须包含一个时间戳列，对应时序数据中的时间，例如 OpenTSDB/Prometheus 的 <code>timestamp</code>。
时间戳列通过关键字 <code>timestamp key</code> 设置，例如 <code>TIMESTAMP KEY(ts)</code>。</p><h2 id=tag-列>Tag 列</h2><p><code>Tag</code> 关键字定义了一个字段作为标签列，和时序数据中的 <code>tag</code> 类似，例如 OpenTSDB 的 <code>tag</code> 或 Prometheus 的 <code>label</code>。</p><h2 id=主键>主键</h2><p>主键用于数据去重和排序，由一些列和一个时间列组成。
主键可以通过以下一些方式设置：</p><ul><li>使用 <code>primary key</code> 关键字</li><li>使用 <code>tag</code> 来自动生成 TSID，HoraeDB 默认将使用 <code>(TSID,timestamp)</code> 作为主键。</li><li>只设置时间戳列，HoraeDB 将使用 <code>(timestamp)</code> 作为主键。</li></ul><p>注意：如果同时指定了主键和 <code>Tag</code> 列，那么 <code>Tag</code> 列只是一个额外的信息标识，不会影响主键生成逻辑。</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:green;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>TABLE</span><span style=color:#bbb> </span>with_primary_key(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>ts<span style=color:#bbb> </span><span style=color:green;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>c1<span style=color:#bbb> </span>STRING<span style=color:#bbb> </span><span style=color:green;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>c2<span style=color:#bbb> </span>STRING<span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>c4<span style=color:#bbb> </span>STRING<span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>c5<span style=color:#bbb> </span>STRING<span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>KEY</span>(ts),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>PRIMARY</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>KEY</span>(c1,<span style=color:#bbb> </span>ts)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>)<span style=color:#bbb> </span>ENGINE<span style=color:#666>=</span>Analytic<span style=color:#bbb> </span><span style=color:green;font-weight:700>WITH</span><span style=color:#bbb> </span>(ttl<span style=color:#666>=</span><span style=color:#ba2121>&#39;7d&#39;</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>TABLE</span><span style=color:#bbb> </span>with_tag(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>ts<span style=color:#bbb> </span><span style=color:green;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>c1<span style=color:#bbb> </span>STRING<span style=color:#bbb> </span>TAG<span style=color:#bbb> </span><span style=color:green;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>c2<span style=color:#bbb> </span>STRING<span style=color:#bbb> </span>TAG<span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>c3<span style=color:#bbb> </span>STRING<span style=color:#bbb> </span>TAG<span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>c4<span style=color:#bbb> </span>DOUBLE<span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>c5<span style=color:#bbb> </span>STRING<span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>c6<span style=color:#bbb> </span>STRING<span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>KEY</span>(ts)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>)<span style=color:#bbb> </span>ENGINE<span style=color:#666>=</span>Analytic<span style=color:#bbb> </span><span style=color:green;font-weight:700>WITH</span><span style=color:#bbb> </span>(ttl<span style=color:#666>=</span><span style=color:#ba2121>&#39;7d&#39;</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>TABLE</span><span style=color:#bbb> </span>with_timestamp(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>ts<span style=color:#bbb> </span><span style=color:green;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>c1<span style=color:#bbb> </span>STRING<span style=color:#bbb> </span><span style=color:green;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>c2<span style=color:#bbb> </span>STRING<span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>c3<span style=color:#bbb> </span>STRING<span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>c4<span style=color:#bbb> </span>DOUBLE<span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>c5<span style=color:#bbb> </span>STRING<span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>c6<span style=color:#bbb> </span>STRING<span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>KEY</span>(ts)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>)<span style=color:#bbb> </span>ENGINE<span style=color:#666>=</span>Analytic<span style=color:#bbb> </span><span style=color:green;font-weight:700>WITH</span><span style=color:#bbb> </span>(ttl<span style=color:#666>=</span><span style=color:#ba2121>&#39;7d&#39;</span>);<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=tsid>TSID</h2><p>如果建表时没有设置主键，并且提供了 <code>Tag</code> 列，HoraeDB 会自动生成一个 <code>TSID</code> 列和时间戳列作为主键。<code>TSID</code> 由所有 <code>Tag</code> 列的 hash 值生成，本质上这是一种自动生成 ID 的机制。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-7d861cbbbb946005aa361b47211951d3>2 - 标识符</h1><p>HoraeDB 中表名、列名等标识符不能是保留关键字或以数字和标点符号开始，不过 HoraeDB 允许用反引号引用标识符（`）。在这种情况下，它可以是任何字符串，如 <code>00_table</code> 或 <code>select</code>。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-a56eddbde23fb9aec1ef2f67e7dfaec3>3 - 表结构操作</h1><p>本章介绍表结构相关 SQL 语句：</p></div><div class=td-content><h1 id=pg-68dd845e51ad6e6c2c8d0e90d0386830>3.1 - ALTER TABLE</h1><p>使用 <code>ALTER TABLE</code> 可以改变表的结构和参数 .</p><h2 id=变更表结构>变更表结构</h2><p>例如可以使用 <code>ADD COLUMN</code> 增加表的列 :</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#408080;font-style:italic>-- create a table and add a column to it
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:green;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>TABLE</span><span style=color:#bbb> </span><span style=color:#666>`</span>t<span style=color:#666>`</span>(a<span style=color:#bbb> </span><span style=color:green>int</span>,<span style=color:#bbb> </span>t<span style=color:#bbb> </span><span style=color:green;font-weight:700>timestamp</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb> </span><span style=color:green;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>KEY</span>(t))<span style=color:#bbb> </span>ENGINE<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>Analytic;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>ALTER</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>TABLE</span><span style=color:#bbb> </span><span style=color:#666>`</span>t<span style=color:#666>`</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>ADD</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>COLUMN</span><span style=color:#bbb> </span>(b<span style=color:#bbb> </span>string);<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p>变更后的表结构如下：</p><pre tabindex=0><code>-- DESCRIBE TABLE `t`;

name    type        is_primary  is_nullable is_tag

t       timestamp   true        false       false
tsid    uint64      true        false       false
a       int         false       true        false
b       string      false       true        false
</code></pre><h2 id=变更表参数>变更表参数</h2><p>例如可以使用 <code>MODIFY SETTING</code> 修改表的参数 :</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#408080;font-style:italic>-- create a table and add a column to it
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:green;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>TABLE</span><span style=color:#bbb> </span><span style=color:#666>`</span>t<span style=color:#666>`</span>(a<span style=color:#bbb> </span><span style=color:green>int</span>,<span style=color:#bbb> </span>t<span style=color:#bbb> </span><span style=color:green;font-weight:700>timestamp</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb> </span><span style=color:green;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>KEY</span>(t))<span style=color:#bbb> </span>ENGINE<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>Analytic;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>ALTER</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>TABLE</span><span style=color:#bbb> </span><span style=color:#666>`</span>t<span style=color:#666>`</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>MODIFY</span><span style=color:#bbb> </span>SETTING<span style=color:#bbb> </span>write_buffer_size<span style=color:#666>=</span><span style=color:#ba2121>&#39;300M&#39;</span>;<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p>上面的 SQL 用来更改 <code>writer_buffer</code> 大小，变更后的建表如下：</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:green;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>TABLE</span><span style=color:#bbb> </span><span style=color:#666>`</span>t<span style=color:#666>`</span><span style=color:#bbb> </span>(<span style=color:#666>`</span>tsid<span style=color:#666>`</span><span style=color:#bbb> </span>uint64<span style=color:#bbb> </span><span style=color:green;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb> </span><span style=color:#666>`</span>t<span style=color:#666>`</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>timestamp</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb> </span><span style=color:#666>`</span>a<span style=color:#666>`</span><span style=color:#bbb> </span><span style=color:green>int</span>,<span style=color:#bbb> </span><span style=color:green;font-weight:700>PRIMARY</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>KEY</span>(tsid,t),<span style=color:#bbb> </span><span style=color:green;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>KEY</span>(t))<span style=color:#bbb> </span>ENGINE<span style=color:#666>=</span>Analytic<span style=color:#bbb> </span><span style=color:green;font-weight:700>WITH</span>(arena_block_size<span style=color:#666>=</span><span style=color:#ba2121>&#39;2097152&#39;</span>,<span style=color:#bbb> </span>compaction_strategy<span style=color:#666>=</span><span style=color:#ba2121>&#39;default&#39;</span>,<span style=color:#bbb> </span>compression<span style=color:#666>=</span><span style=color:#ba2121>&#39;ZSTD&#39;</span>,<span style=color:#bbb> </span>enable_ttl<span style=color:#666>=</span><span style=color:#ba2121>&#39;true&#39;</span>,<span style=color:#bbb> </span>num_rows_per_row_group<span style=color:#666>=</span><span style=color:#ba2121>&#39;8192&#39;</span>,<span style=color:#bbb> </span>segment_duration<span style=color:#666>=</span><span style=color:#ba2121>&#39;&#39;</span>,<span style=color:#bbb> </span>storage_format<span style=color:#666>=</span><span style=color:#ba2121>&#39;AUTO&#39;</span>,<span style=color:#bbb> </span>ttl<span style=color:#666>=</span><span style=color:#ba2121>&#39;7d&#39;</span>,<span style=color:#bbb> </span>update_mode<span style=color:#666>=</span><span style=color:#ba2121>&#39;OVERWRITE&#39;</span>,<span style=color:#bbb> </span>write_buffer_size<span style=color:#666>=</span><span style=color:#ba2121>&#39;314572800&#39;</span>)<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p>除此之外，我们可以修改其 <code>ttl</code> 为 10 天：</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:green;font-weight:700>ALTER</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>TABLE</span><span style=color:#bbb> </span><span style=color:#666>`</span>t<span style=color:#666>`</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>MODIFY</span><span style=color:#bbb> </span>SETTING<span style=color:#bbb> </span>ttl<span style=color:#666>=</span><span style=color:#ba2121>&#39;10d&#39;</span>;<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div></div><div class=td-content style=page-break-before:always><h1 id=pg-5f7ab6b13fb6fbd5ae2e2ca6e05687fd>3.2 - DROP TABLE</h1><h2 id=基础语法>基础语法</h2><p>删除表的基础语法如下:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:green;font-weight:700>DROP</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>TABLE</span><span style=color:#bbb> </span>[<span style=color:green;font-weight:700>IF</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>EXISTS</span>]<span style=color:#bbb> </span><span style=color:green;font-weight:700>table_name</span><span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p><code>Drop Table</code> 用来删除一个表，请谨慎使用这个语句，因为会同时删除表的定义和表的数据，并且无法恢复。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-6d8b07bab2bfacd40385ad0d54b7f17c>3.3 - 创建表</h1><h2 id=基础语法>基础语法</h2><p>建表的基础语法如下 ( <code>[]</code> 之间的内容是可选部分):</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:green;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>TABLE</span><span style=color:#bbb> </span>[<span style=color:green;font-weight:700>IF</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>EXISTS</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>table_name</span><span style=color:#bbb> </span>(<span style=color:#bbb> </span>column_definitions<span style=color:#bbb> </span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>ENGINE<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>engine_type<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>[<span style=color:green;font-weight:700>WITH</span><span style=color:#bbb> </span>(<span style=color:#bbb> </span>table_options<span style=color:#bbb> </span>)];<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p>列定义的语法 :</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:green;font-weight:700>column_name</span><span style=color:#bbb> </span>column_type<span style=color:#bbb> </span>[[<span style=color:green;font-weight:700>NOT</span>]<span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>]<span style=color:#bbb> </span><span>{</span>[TAG]<span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span>[<span style=color:green;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>KEY</span>]<span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span>[<span style=color:green;font-weight:700>PRIMARY</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>KEY</span>]<span>}</span><span style=color:#bbb> </span>[<span style=color:green;font-weight:700>DICTIONARY</span>]<span style=color:#bbb> </span>[<span style=color:green;font-weight:700>COMMENT</span><span style=color:#bbb> </span><span style=color:#ba2121>&#39;&#39;</span>]<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p>表选项的语法是键-值对，值用单引号（<code>'</code>）来引用。例如：</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>...<span style=color:#bbb> </span><span style=color:green;font-weight:700>WITH</span><span style=color:#bbb> </span>(<span style=color:#bbb> </span>enable_ttl<span style=color:#666>=</span><span style=color:#ba2121>&#39;false&#39;</span><span style=color:#bbb> </span>)<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=if-not-exists>IF NOT EXISTS</h2><p>添加 <code>IF NOT EXISTS</code> 时，HoraeDB 在表名已经存在时会忽略建表错误。</p><h2 id=定义列>定义列</h2><p>一个列的定义至少应该包含名称和类型部分，支持的类型见 <a href=/cn/docs/user-guide/sql/model/data_types/>这里</a>。</p><p>列默认为可空，即 &ldquo;NULL " 关键字是隐含的；添加 <code>NOT NULL</code> 时列不可为空。</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#408080;font-style:italic>-- this definition
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>a_nullable<span style=color:#bbb> </span><span style=color:green>int</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#408080;font-style:italic>-- equals to
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>a_nullable<span style=color:#bbb> </span><span style=color:green>int</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#408080;font-style:italic>-- add NOT NULL to make it required
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>b_not_null<span style=color:#bbb> </span><span style=color:green;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span><span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p>定义列时可以使用相关的关键字将列标记为 <a href=/cn/docs/user-guide/sql/model/special_columns/>特殊列</a>。</p><p>对于 string 的 tag 列，推荐设置为字典类型来减少内存占用：</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#666>`</span>tag1<span style=color:#666>`</span><span style=color:#bbb> </span>string<span style=color:#bbb> </span>TAG<span style=color:#bbb> </span><span style=color:green;font-weight:700>DICTIONARY</span><span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=引擎设置>引擎设置</h2><p>HoraeDB 支持指定某个表使用哪种引擎，目前支持的引擎类型为 <code>Analytic</code>。注意这个属性设置后不可更改。</p><h2 id=分区设置>分区设置</h2><blockquote><p>仅适用于集群部署模式</p></blockquote><pre tabindex=0><code>CREATE TABLE ... PARTITION BY KEY
</code></pre><p>下面这个例子创建了一个具有 8 个分区的表，分区键为 <code>name</code>：</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:green;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>TABLE</span><span style=color:#bbb> </span><span style=color:#666>`</span>demo<span style=color:#666>`</span><span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#666>`</span>name<span style=color:#666>`</span><span style=color:#bbb> </span>string<span style=color:#bbb> </span>TAG<span style=color:#bbb> </span><span style=color:green;font-weight:700>COMMENT</span><span style=color:#bbb> </span><span style=color:#ba2121>&#39;client username&#39;</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#666>`</span>value<span style=color:#666>`</span><span style=color:#bbb> </span>double<span style=color:#bbb> </span><span style=color:green;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#666>`</span>t<span style=color:#666>`</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>timestamp</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>timestamp</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>KEY</span><span style=color:#bbb> </span>(t)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>PARTITION<span style=color:#bbb> </span><span style=color:green;font-weight:700>BY</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>KEY</span>(name)<span style=color:#bbb> </span>PARTITIONS<span style=color:#bbb> </span><span style=color:#666>8</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>ENGINE<span style=color:#666>=</span>Analytic<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>with</span><span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>enable_ttl<span style=color:#666>=</span><span style=color:#ba2121>&#39;false&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>)<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div></div><div class=td-content style=page-break-before:always><h1 id=pg-bc38c5a475ad6316c41c4e31be03630d>4 - 数据操作</h1><p>本章介绍数据操作相关的 SQL.</p></div><div class=td-content><h1 id=pg-55eb2b9d918713a31388dd5e355f569d>4.1 - INSERT</h1><h2 id=基础语法>基础语法</h2><p>写入数据的基础语法如下：</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:green;font-weight:700>INSERT</span><span style=color:#bbb> </span>[<span style=color:green;font-weight:700>INTO</span>]<span style=color:#bbb> </span>tbl_name<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>[(col_name<span style=color:#bbb> </span>[,<span style=color:#bbb> </span>col_name]<span style=color:#bbb> </span>...)]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span>{</span><span style=color:#bbb> </span><span>{</span><span style=color:green;font-weight:700>VALUES</span><span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span>VALUE<span>}</span><span style=color:#bbb> </span>(value_list)<span style=color:#bbb> </span>[,<span style=color:#bbb> </span>(value_list)]<span style=color:#bbb> </span>...<span style=color:#bbb> </span><span>}</span><span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p>写入一行数据的示例如下：</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:green;font-weight:700>INSERT</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>INTO</span><span style=color:#bbb> </span>demo(<span style=color:#666>`</span><span style=color:green;font-weight:700>timestamp</span><span style=color:#666>`</span>,<span style=color:#bbb> </span>tag1)<span style=color:#bbb> </span><span style=color:green;font-weight:700>VALUES</span>(<span style=color:#666>1667374200022</span>,<span style=color:#bbb> </span><span style=color:#ba2121>&#39;horaedb&#39;</span>)<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div></div><div class=td-content style=page-break-before:always><h1 id=pg-ae9a3b5e9aba5151ee26972acc9f7e2e>4.2 - SELECT</h1><h2 id=基础语法>基础语法</h2><p>数据查询的基础语法如下：</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:green;font-weight:700>SELECT</span><span style=color:#bbb> </span>select_expr<span style=color:#bbb> </span>[,<span style=color:#bbb> </span>select_expr]<span style=color:#bbb> </span>...<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>FROM</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>table_name</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>[<span style=color:green;font-weight:700>WHERE</span><span style=color:#bbb> </span>where_condition]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>[<span style=color:green;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>BY</span><span style=color:#bbb> </span><span>{</span>col_name<span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span>expr<span>}</span><span style=color:#bbb> </span>...<span style=color:#bbb> </span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>[<span style=color:green;font-weight:700>ORDER</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>BY</span><span style=color:#bbb> </span><span>{</span>col_name<span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span>expr<span>}</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>[<span style=color:green;font-weight:700>ASC</span><span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>DESC</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>[<span style=color:green;font-weight:700>LIMIT</span><span style=color:#bbb> </span>[<span style=color:green;font-weight:700>offset</span>,]<span style=color:#bbb> </span><span style=color:green;font-weight:700>row_count</span><span style=color:#bbb> </span>]<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p>数据查询的语法和 mysql 类似，示例如下：</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:green;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>*</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>FROM</span><span style=color:#bbb> </span><span style=color:#666>`</span>demo<span style=color:#666>`</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>WHERE</span><span style=color:#bbb> </span>time_stamp<span style=color:#bbb> </span><span style=color:#666>&gt;</span><span style=color:#bbb> </span><span style=color:#ba2121>&#39;2022-10-11 00:00:00&#39;</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>AND</span><span style=color:#bbb> </span>time_stamp<span style=color:#bbb> </span><span style=color:#666>&lt;</span><span style=color:#bbb> </span><span style=color:#ba2121>&#39;2022-10-12 00:00:00&#39;</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>LIMIT</span><span style=color:#bbb> </span><span style=color:#666>10</span><span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div></div><div class=td-content style=page-break-before:always><h1 id=pg-b503efb26df2941b96a344484d6a91a2>5 - 常用 SQL</h1><p>HoraeDB 中有许多实用的 SQL 工具，可以辅助表操作或查询检查。</p><h2 id=查看建表语句>查看建表语句</h2><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:green;font-weight:700>SHOW</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>TABLE</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>table_name</span>;<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p><code>SHOW CREATE TABLE</code> 返回指定表的当前版本的创建语句，包括列定义、表引擎和参数选项等。例如：</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#408080;font-style:italic>-- create one table
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:green;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>TABLE</span><span style=color:#bbb> </span><span style=color:#666>`</span>t<span style=color:#666>`</span><span style=color:#bbb> </span>(a<span style=color:#bbb> </span><span style=color:green>bigint</span>,<span style=color:#bbb> </span>b<span style=color:#bbb> </span><span style=color:green>int</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>default</span><span style=color:#bbb> </span><span style=color:#666>3</span>,<span style=color:#bbb> </span><span style=color:green;font-weight:700>c</span><span style=color:#bbb> </span>string<span style=color:#bbb> </span><span style=color:green;font-weight:700>default</span><span style=color:#bbb> </span><span style=color:#ba2121>&#39;x&#39;</span>,<span style=color:#bbb> </span>d<span style=color:#bbb> </span><span style=color:green>smallint</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>null</span>,<span style=color:#bbb> </span>t<span style=color:#bbb> </span><span style=color:green;font-weight:700>timestamp</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb> </span><span style=color:green;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>KEY</span>(t))<span style=color:#bbb> </span>ENGINE<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>Analytic;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#408080;font-style:italic>-- Result: affected_rows: 0
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#408080;font-style:italic>-- show how one table should be created.
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:green;font-weight:700>SHOW</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>TABLE</span><span style=color:#bbb> </span><span style=color:#666>`</span>t<span style=color:#666>`</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#408080;font-style:italic>-- Result DDL:
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:green;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>TABLE</span><span style=color:#bbb> </span><span style=color:#666>`</span>t<span style=color:#666>`</span><span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#666>`</span>t<span style=color:#666>`</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>timestamp</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#666>`</span>tsid<span style=color:#666>`</span><span style=color:#bbb> </span>uint64<span style=color:#bbb> </span><span style=color:green;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#666>`</span>a<span style=color:#666>`</span><span style=color:#bbb> </span><span style=color:green>bigint</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#666>`</span>b<span style=color:#666>`</span><span style=color:#bbb> </span><span style=color:green>int</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#666>`</span><span style=color:green;font-weight:700>c</span><span style=color:#666>`</span><span style=color:#bbb> </span>string,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#666>`</span>d<span style=color:#666>`</span><span style=color:#bbb> </span><span style=color:green>smallint</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>PRIMARY</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>KEY</span>(t,tsid),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>KEY</span>(t)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>)<span style=color:#bbb> </span>ENGINE<span style=color:#666>=</span>Analytic<span style=color:#bbb> </span><span style=color:green;font-weight:700>WITH</span><span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>arena_block_size<span style=color:#666>=</span><span style=color:#ba2121>&#39;2097152&#39;</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>compaction_strategy<span style=color:#666>=</span><span style=color:#ba2121>&#39;default&#39;</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>compression<span style=color:#666>=</span><span style=color:#ba2121>&#39;ZSTD&#39;</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>enable_ttl<span style=color:#666>=</span><span style=color:#ba2121>&#39;true&#39;</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>num_rows_per_row_group<span style=color:#666>=</span><span style=color:#ba2121>&#39;8192&#39;</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>segment_duration<span style=color:#666>=</span><span style=color:#ba2121>&#39;&#39;</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>ttl<span style=color:#666>=</span><span style=color:#ba2121>&#39;7d&#39;</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>update_mode<span style=color:#666>=</span><span style=color:#ba2121>&#39;OVERWRITE&#39;</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>write_buffer_size<span style=color:#666>=</span><span style=color:#ba2121>&#39;33554432&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>)<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=查看表信息>查看表信息</h2><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:green;font-weight:700>DESCRIBE</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>table_name</span>;<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p><code>DESCRIBE</code> 语句返回一个表的详细结构信息，包括每个字段的名称和类型，字段是否为 <code>Tag</code> 或主键，字段是否可空等。
此外，自动生成的字段 <code>tsid</code> 也会展示在结果里。</p><p>例如：</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:green;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>TABLE</span><span style=color:#bbb> </span><span style=color:#666>`</span>t<span style=color:#666>`</span>(a<span style=color:#bbb> </span><span style=color:green>int</span>,<span style=color:#bbb> </span>b<span style=color:#bbb> </span>string,<span style=color:#bbb> </span>t<span style=color:#bbb> </span><span style=color:green;font-weight:700>timestamp</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb> </span><span style=color:green;font-weight:700>TIMESTAMP</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>KEY</span>(t))<span style=color:#bbb> </span>ENGINE<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>Analytic;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>DESCRIBE</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>TABLE</span><span style=color:#bbb> </span><span style=color:#666>`</span>t<span style=color:#666>`</span>;<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p>返回结果如下：</p><pre tabindex=0><code>name    type        is_primary  is_nullable is_tag

t       timestamp   true        false       false
tsid    uint64      true        false       false
a       int         false       true        false
b       string      false       true        false
</code></pre><h2 id=解释执行计划>解释执行计划</h2><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:green;font-weight:700>EXPLAIN</span><span style=color:#bbb> </span>query;<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p><code>EXPLAIN</code> 语句结果展示一个查询如何被执行。例如：</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:green;font-weight:700>EXPLAIN</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>max</span>(value)<span style=color:#bbb> </span><span style=color:green;font-weight:700>AS</span><span style=color:#bbb> </span>c1,<span style=color:#bbb> </span><span style=color:green;font-weight:700>avg</span>(value)<span style=color:#bbb> </span><span style=color:green;font-weight:700>AS</span><span style=color:#bbb> </span>c2<span style=color:#bbb> </span><span style=color:green;font-weight:700>FROM</span><span style=color:#bbb> </span><span style=color:#666>`</span>t<span style=color:#666>`</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>BY</span><span style=color:#bbb> </span>name;<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p>结果如下：</p><pre tabindex=0><code>logical_plan
Projection: #MAX(07_optimizer_t.value) AS c1, #AVG(07_optimizer_t.value) AS c2
  Aggregate: groupBy=[[#07_optimizer_t.name]], aggr=[[MAX(#07_optimizer_t.value), AVG(#07_optimizer_t.value)]]
    TableScan: 07_optimizer_t projection=Some([name, value])

physical_plan
ProjectionExec: expr=[MAX(07_optimizer_t.value)@1 as c1, AVG(07_optimizer_t.value)@2 as c2]
  AggregateExec: mode=FinalPartitioned, gby=[name@0 as name], aggr=[MAX(07_optimizer_t.value), AVG(07_optimizer_t.value)]
    CoalesceBatchesExec: target_batch_size=4096
      RepartitionExec: partitioning=Hash([Column { name: \&#34;name\&#34;, index: 0 }], 6)
        AggregateExec: mode=Partial, gby=[name@0 as name], aggr=[MAX(07_optimizer_t.value), AVG(07_optimizer_t.value)]
          ScanTable: table=07_optimizer_t, parallelism=8, order=None
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-6eb5d8309a31ca1c8c3311aae4346b17>6 - 配置项</h1><p>建表时可以使用下列的选项配置引擎：</p><ul><li><p><code>enable_ttl</code>：布尔类型，默认为 <code>true</code>，当一个表配置 TTL 时，早于 <code>ttl</code> 的数据不会被查询到并且会被删除。</p></li><li><p><code>ttl</code>：<code>duration</code> 类型，默认值为<code>7d</code>，此项定义数据的生命周期，只在 <code>enable_ttl</code> 为 <code>true</code> 的情况下使用。</p></li><li><p><code>storage_format</code>： <code>string</code> 类型，数据存储的格式，有两种可选:</p><ul><li><code>columnar</code>, 默认值</li><li><code>hybrid</code>, 注意：此功能仍在开发中，将来可能会发生变化。</li></ul></li></ul><p>上述两种存储格式详见 <a href=/cn/docs/user-guide/sql/engine_options/#存储格式>存储格式</a> 部分。</p><h2 id=存储格式>存储格式</h2><p>HoraeDB 支持两种存储格式，一个是 <code>columnar</code>, 这是传统的列式格式，一个物理列中存储表的一个列。</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>| Timestamp | Device ID | Status Code | Tag 1 | Tag 2 |
</span></span><span style=display:flex><span>| --------- |---------- | ----------- | ----- | ----- |
</span></span><span style=display:flex><span>| 12:01     | A         | 0           | v1    | v1    |
</span></span><span style=display:flex><span>| 12:01     | B         | 0           | v2    | v2    |
</span></span><span style=display:flex><span>| 12:02     | A         | 0           | v1    | v1    |
</span></span><span style=display:flex><span>| 12:02     | B         | 1           | v2    | v2    |
</span></span><span style=display:flex><span>| 12:03     | A         | 0           | v1    | v1    |
</span></span><span style=display:flex><span>| 12:03     | B         | 0           | v2    | v2    |
</span></span><span style=display:flex><span>| .....     |           |             |       |       |
</span></span></code></pre></td></tr></table></div></div><p>另一个是 <code>hybrid</code>, 当前还在实验阶段的存储格式，用于在列式存储中模拟面向行的存储，以加速经典的时序查询。</p><p>在经典的时序场景中，如 IoT 或 DevOps，查询通常会先按系列 ID（或设备 ID）分组，然后再按时间戳分组。
为了在这些场景中实现良好的性能，数据的物理布局应该与这种风格相匹配， <code>hybrid</code> 格式就是这样提出的。</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span> | Device ID | Timestamp           | Status Code | Tag 1 | Tag 2 | minTime | maxTime |
</span></span><span style=display:flex><span> |-----------|---------------------|-------------|-------|-------|---------|---------|
</span></span><span style=display:flex><span> | A         | [12:01,12:02,12:03] | [0,0,0]     | v1    | v1    | 12:01   | 12:03   |
</span></span><span style=display:flex><span> | B         | [12:01,12:02,12:03] | [0,1,0]     | v2    | v2    | 12:01   | 12:03   |
</span></span><span style=display:flex><span> | ...       |                     |             |       |       |         |         |
</span></span></code></pre></td></tr></table></div></div><ul><li>在一个文件中，同一个主键（例如设备 ID）的数据会被压缩到一行。</li><li>除了主键之外的列被分成两类：<ul><li><code>collapsible</code>, 这些列会被压缩成一个 list，常用于时序表中的<code>field</code>字段。<ul><li>注意: 当前仅支持定长的字段</li></ul></li><li><code>non-collapsible</code>, 这些列只能包含一个去重值，常用于时序表中的<code>tag</code>字段。<ul><li>注意: 当前仅支持字符串类型</li></ul></li></ul></li><li>另外多加了两个字段，<code>minTime</code> 和 <code>maxTime</code>， 用于查询中过滤不必要的数据。<ul><li>注意: 暂未实现此能力</li></ul></li></ul><h3 id=示例>示例</h3><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:green;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>TABLE</span><span style=color:#bbb> </span><span style=color:#666>`</span>device<span style=color:#666>`</span><span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#666>`</span>ts<span style=color:#666>`</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>timestamp</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#666>`</span>tag1<span style=color:#666>`</span><span style=color:#bbb> </span>string<span style=color:#bbb> </span>tag,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#666>`</span>tag2<span style=color:#666>`</span><span style=color:#bbb> </span>string<span style=color:#bbb> </span>tag,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#666>`</span>value1<span style=color:#666>`</span><span style=color:#bbb> </span>double,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#666>`</span>value2<span style=color:#666>`</span><span style=color:#bbb> </span><span style=color:green>int</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>timestamp</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>KEY</span><span style=color:#bbb> </span>(ts))<span style=color:#bbb> </span>ENGINE<span style=color:#666>=</span>Analytic<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>with</span><span style=color:#bbb> </span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>enable_ttl<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#ba2121>&#39;false&#39;</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>storage_format<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#ba2121>&#39;hybrid&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p>这段语句会创建一个混合存储格式的表, 这种情况下用户可以通过 <a href=https://formulae.brew.sh/formula/parquet-tools>parquet-tools</a>查看数据格式.
上面定义的表的 parquet 结构如下所示：</p><pre tabindex=0><code>message arrow_schema {
  optional group ts (LIST) {
    repeated group list {
      optional int64 item (TIMESTAMP(MILLIS,false));
    }
  }
  required int64 tsid (INTEGER(64,false));
  optional binary tag1 (STRING);
  optional binary tag2 (STRING);
  optional group value1 (LIST) {
    repeated group list {
      optional double item;
    }
  }
  optional group value2 (LIST) {
    repeated group list {
      optional int32 item;
    }
  }
}
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-0ef89f21a5acc9b299f40523cb5ab1f8>7 - 标量函数</h1><p>HoraeDB SQL 基于 <a href=https://github.com/CeresDB/arrow-datafusion>DataFusion</a> 实现，支持的标量函数如下。更多详情请参考： <a href=https://github.com/CeresDB/arrow-datafusion/blob/master/docs/source/user-guide/sql/scalar_functions.md>Datafusion</a></p><h2 id=数值函数>数值函数</h2><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>abs(x)</td><td>绝对值</td></tr><tr><td>acos(x)</td><td>反余弦</td></tr><tr><td>asin(x)</td><td>反正弦</td></tr><tr><td>atan(x)</td><td>反正切</td></tr><tr><td>atan2(y, x)</td><td>y/x 的反正切</td></tr><tr><td>ceil(x)</td><td>小于或等于参数的最接近整数</td></tr><tr><td>cos(x)</td><td>余弦</td></tr><tr><td>exp(x)</td><td>指数</td></tr><tr><td>floor(x)</td><td>大于或等于参数的最接近整数</td></tr><tr><td>ln(x)</td><td>自然对数</td></tr><tr><td>log10(x)</td><td>以 10 为底的对数</td></tr><tr><td>log2(x)</td><td>以 2 为底的对数</td></tr><tr><td>power(base, exponent)</td><td>幂函数</td></tr><tr><td>round(x)</td><td>四舍五入</td></tr><tr><td>signum(x)</td><td>根据参数的正负返回 -1、0、+1</td></tr><tr><td>sin(x)</td><td>正弦</td></tr><tr><td>sqrt(x)</td><td>平方根</td></tr><tr><td>tan(x)</td><td>正切</td></tr><tr><td>trunc(x)</td><td>截断计算，取整（向零取整）</td></tr></tbody></table><h2 id=条件函数>条件函数</h2><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>coalesce</td><td>如果它的参数中有一个不为 null，则返回第一个参数，如果所有参数均为 null，则返回 null。当从数据库中检索数据用于显示时，它经常用于用默认值替换 null 值。</td></tr><tr><td>nullif</td><td>如果 value1 等于 value2，则返回 null 值；否则返回 value1。这可用于执行与 coalesce 表达式相反的操作</td></tr></tbody></table><h2 id=字符函数>字符函数</h2><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>ascii</td><td>返回参数的第一个字符的 ascii 数字编码。在 UTF8 编码下，返回字符的 Unicode 码点。在其他多字节编码中，参数必须是 ASCII 字符。</td></tr><tr><td>bit_length</td><td>返回字符串的比特位数。</td></tr><tr><td>btrim</td><td>从字符串的开头和结尾删除给定字符串中的字符组成的最长字符串</td></tr><tr><td>char_length</td><td>等效于 length。</td></tr><tr><td>character_length</td><td>等效于 length。</td></tr><tr><td>concat</td><td>将两个或多个字符串合并为一个字符串。</td></tr><tr><td>concat_ws</td><td>使用给定的分隔符组合两个值。</td></tr><tr><td>chr</td><td>根据数字码返回字符。</td></tr><tr><td>initcap</td><td>将字符串中每个单词的首字母大写。</td></tr><tr><td>left</td><td>返回字符串的指定最左边字符。</td></tr><tr><td>length</td><td>返回字符串中字符的数量。</td></tr><tr><td>lower</td><td>将字符串中的所有字符转换为它们的小写。</td></tr><tr><td>lpad</td><td>使用特定字符集将字符串左填充到给定长度。</td></tr><tr><td>ltrim</td><td>从字符串的开头删除由字符中的字符组成的最长字符串（默认为空格）。</td></tr><tr><td>md5</td><td>计算给定字符串的 MD5 散列值。</td></tr><tr><td>octet_length</td><td>等效于 length。</td></tr><tr><td>repeat</td><td>返回一个由输入字符串重复指定次数组成的字符串。</td></tr><tr><td>replace</td><td>替换字符串中所有子字符串的出现为新子字符串。</td></tr><tr><td>reverse</td><td>反转字符串。</td></tr><tr><td>right</td><td>返回字符串的指定最右边字符。</td></tr><tr><td>rpad</td><td>使用特定字符集将字符串右填充到给定长度。</td></tr><tr><td>rtrim</td><td>从字符串的结尾删除包含 characters 中任何字符的最长字符串。</td></tr><tr><td>digest</td><td>计算给定字符串的散列值。</td></tr><tr><td>split_part</td><td>按指定分隔符拆分字符串，并从结果数组中返回</td></tr><tr><td>starts_with</td><td>检查字符串是否以给定字符串开始</td></tr><tr><td>strpos</td><td>搜索字符串是否包含一个给定的字符串，并返回位置</td></tr><tr><td>substr</td><td>提取子字符串</td></tr><tr><td>translate</td><td>把字符串翻译成另一种字符集 Translates one set of characters into another.</td></tr><tr><td>trim</td><td>移除字符串两侧的空白字符或其他指定字符。</td></tr><tr><td>upper</td><td>将字符串中的所有字符转换为它们的大写。</td></tr></tbody></table><h2 id=正则函数>正则函数</h2><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>regexp_match</td><td>判断一个字符串是否匹配正则表达式</td></tr><tr><td>regexp_replace</td><td>使用新字符串替换正则匹配的字符串中内容</td></tr></tbody></table><h2 id=时间函数>时间函数</h2><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>to_timestamp</td><td>将字符串转换为 Timestamp(Nanoseconds，None)类型。</td></tr><tr><td>to_timestamp_millis</td><td>将字符串转换为 Timestamp(Milliseconds，None)类型。</td></tr><tr><td>to_timestamp_micros</td><td>将字符串转换为 Timestamp(Microseconds，None)类型。</td></tr><tr><td>to_timestamp_seconds</td><td>将字符串转换为 Timestamp(Seconds，None)类型。</td></tr><tr><td>extract</td><td>从日期/时间值中检索年份或小时等子字段。</td></tr><tr><td>date_part</td><td>从日期/时间值中检索子字段。</td></tr><tr><td>date_trunc</td><td>将日期/时间值截断到指定的精度。</td></tr><tr><td>date_bin</td><td>将日期/时间值按指定精度进行分组。</td></tr><tr><td>from_unixtime</td><td>将 Unix 时代转换为 Timestamp(Nanoseconds，None)类型。</td></tr><tr><td>now</td><td>作为 Timestamp(Nanoseconds，UTC)返回当前时间。</td></tr></tbody></table><h2 id=其他函数>其他函数</h2><table><thead><tr><th>Function</th><th>描述</th></tr></thead><tbody><tr><td>array</td><td>创建有一个数组</td></tr><tr><td>arrow_typeof</td><td>返回内置的数据类型</td></tr><tr><td>in_list</td><td>检测数值是否在 list 里面</td></tr><tr><td>random</td><td>生成随机值</td></tr><tr><td>sha224</td><td>sha224</td></tr><tr><td>sha256</td><td>sha256</td></tr><tr><td>sha384</td><td>sha384</td></tr><tr><td>sha512</td><td>sha512</td></tr><tr><td>to_hex</td><td>转换为 16 进制</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-efa48a3298c70ae47edb1fd4b128cd3e>8 - 聚合函数</h1><p>HoraeDB SQL 基于 <a href=https://github.com/apache/arrow-datafusion>DataFusion</a> 实现，支持的聚合函数如下。更多详情请参考： <a href=https://github.com/apache/arrow-datafusion/blob/master/docs/source/user-guide/sql/aggregate_functions.md>Datafusion</a></p><h2 id=常用>常用</h2><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>min</td><td>最小值</td></tr><tr><td>max</td><td>最大值</td></tr><tr><td>count</td><td>求行数</td></tr><tr><td>avg</td><td>平均值</td></tr><tr><td>sum</td><td>求和</td></tr><tr><td>array_agg</td><td>把数据放到一个数组</td></tr></tbody></table><h2 id=统计>统计</h2><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>var / var_samp</td><td>返回给定列的样本方差</td></tr><tr><td>var_pop</td><td>返回给定列的总体方差</td></tr><tr><td>stddev / stddev_samp</td><td>返回给定列的样本标准差</td></tr><tr><td>stddev_pop</td><td>返回给定列的总体标准差</td></tr><tr><td>covar / covar_samp</td><td>返回给定列的样本协方差</td></tr><tr><td>covar_pop</td><td>返回给定列的总体协方差</td></tr><tr><td>corr</td><td>返回给定列的相关系数</td></tr></tbody></table><h2 id=估值函数>估值函数</h2><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>approx_distinct</td><td>返回输入值的近似去重数量（HyperLogLog）</td></tr><tr><td>approx_median</td><td>返回输入值的近似中位数，它是 approx_percentile_cont(x, 0.5) 的简单写法</td></tr><tr><td>approx_percentile_cont</td><td>返回输入值的近似百分位数（TDigest），其中 p 是 0 和 1（包括）之间的 float64，等同于 approx_percentile_cont_with_weight(x, 1, p)</td></tr><tr><td>approx_percentile_cont_with_weight</td><td>返回输入值带权重的近似百分位数（TDigest），其中 w 是权重列表达式，p 是 0 和 1（包括）之间的 float64</td></tr></tbody></table></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class=td-footer__center>Apache HoraeDB is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.<hr><span class=td-footer__copyright>&copy;
2023&ndash;2024
<span class=td-footer__authors><p>The Apache Software Foundation, Licensed under the Apache License, Version 2.0.</p><p>Apache, the names of Apache projects, and the feather logo are either registered trademarks or trademarks of the Apache Software Foundation in the United States and/or other countries.</p></span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div><hr><div class="row mx-md-2"><div class=td-footer__center><span class=td-footer__copyright>Found a bug in website? <a href=https://github.com/apache/horaedb-docs/issues/new>Open an issue</a> or <a href=https://github.com/apache/horaedb-docs/pulls>submit a pull request</a> on GitHub.</span></div></div><hr></div></footer></div><script src=/js/main.min.f72d00502781aaf278a14088eb2356b1ba2a05ad698a0c43fe86314d74ceab56.js integrity="sha256-9y0AUCeBqvJ4oUCI6yNWsboqBa1pigxD/oYxTXTOq1Y=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>