<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://horaedb.apache.org/docs/user-guide/cluster_deployment/><link rel=alternate type=application/rss+xml href=https://horaedb.apache.org/docs/user-guide/cluster_deployment/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Cluster Deployment | Apache HoraeDB</title>
<meta name=description content="In the Getting Started section, we have introduced the deployment of single HoraeDB instance.
Besides, as a distributed timeseries database, multiple HoraeDB instances can be deployed as a cluster to serve with high availability and scalability.
Currently, work about the integration with kubernetes is still in process, so HoraeDB cluster can only be deployed manually. And there are two modes of cluster deployment:"><meta property="og:url" content="https://horaedb.apache.org/docs/user-guide/cluster_deployment/"><meta property="og:site_name" content="Apache HoraeDB"><meta property="og:title" content="Cluster Deployment"><meta property="og:description" content="In the Getting Started section, we have introduced the deployment of single HoraeDB instance.
Besides, as a distributed timeseries database, multiple HoraeDB instances can be deployed as a cluster to serve with high availability and scalability.
Currently, work about the integration with kubernetes is still in process, so HoraeDB cluster can only be deployed manually. And there are two modes of cluster deployment:"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Cluster Deployment"><meta itemprop=description content="In the Getting Started section, we have introduced the deployment of single HoraeDB instance.
Besides, as a distributed timeseries database, multiple HoraeDB instances can be deployed as a cluster to serve with high availability and scalability.
Currently, work about the integration with kubernetes is still in process, so HoraeDB cluster can only be deployed manually. And there are two modes of cluster deployment:"><meta itemprop=dateModified content="2024-10-28T10:31:41+08:00"><meta itemprop=wordCount content="63"><meta name=twitter:card content="summary"><meta name=twitter:title content="Cluster Deployment"><meta name=twitter:description content="In the Getting Started section, we have introduced the deployment of single HoraeDB instance.
Besides, as a distributed timeseries database, multiple HoraeDB instances can be deployed as a cluster to serve with high availability and scalability.
Currently, work about the integration with kubernetes is still in process, so HoraeDB cluster can only be deployed manually. And there are two modes of cluster deployment:"><link rel=preload href=/scss/main.min.5e43f8574351718e9b44966c9f3a571202ed048c082f457fb574c10b1a1bc56c.css as=style integrity="sha256-XkP4V0NRcY6bRJZsnzpXEgLtBIwIL0V/tXTBCxobxWw=" crossorigin=anonymous><link href=/scss/main.min.5e43f8574351718e9b44966c9f3a571202ed048c082f457fb574c10b1a1bc56c.css rel=stylesheet integrity="sha256-XkP4V0NRcY6bRJZsnzpXEgLtBIwIL0V/tXTBCxobxWw=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Apache HoraeDB</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class="nav-link active" href=/docs/><i class='fa-solid fa-book'></i><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=/blog/><i class='fa-brands fa-blogger'></i><span>Blog</span></a></li><li class=nav-item><a class=nav-link href=/downloads/><i class='fa-solid fa-download'></i><span>Downloads</span></a></li><li class=nav-item><a class=nav-link href=/community/><span>Community</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><ul class=dropdown-menu><li><a class=dropdown-item href=/cn/docs/user-guide/cluster_deployment/>中文</a></li></ul></div></li><li class="td-light-dark-menu nav-item dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown data-bs-display=static aria-label="Toggle theme (auto)"><svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=bd-theme-text><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.d263beddadb65b2d37da4ddd7d211e90.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/user-guide/cluster_deployment/>Return to the regular view of this page</a>.</p></div><h1 class=title>Cluster Deployment</h1><ul><li>1: <a href=#pg-b594c5402ac7944a3ffa540117ff40ad>NoMeta</a></li><li>2: <a href=#pg-f8177b6910dfd52c70228b40053918c4>WithMeta</a></li></ul><div class=content><p>In the <a href=https://horaedb.apache.org/docs/getting-started/>Getting Started</a> section, we have introduced the deployment of single HoraeDB instance.</p><p>Besides, as a distributed timeseries database, multiple HoraeDB instances can be deployed as a cluster to serve with high availability and scalability.</p><p>Currently, work about the integration with kubernetes is still in process, so HoraeDB cluster can only be deployed manually. And there are two modes of cluster deployment:</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-b594c5402ac7944a3ffa540117ff40ad>1 - NoMeta</h1><p><strong>Note: This feature is for testing use only, not recommended for production use, related features may change in the future.</strong></p><p>This guide shows how to deploy a HoraeDB cluster without HoraeMeta, but with static, rule-based routing.</p><p>The crucial point here is that HoraeDB server provides configurable routing function on table name so what we need is just a valid config containing routing rules which will be shipped to every HoraeDB instance in the cluster.</p><h2 id=target>Target</h2><p>First, let&rsquo;s assume that our target is to deploy a cluster consisting of two HoraeDB instances on the same machine. And a large cluster of more HoraeDB instances can be deployed according to the two-instance example.</p><h2 id=prepare-config>Prepare Config</h2><h3 id=basic>Basic</h3><p>Suppose the basic config of HoraeDB is:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[server]
</span></span><span style=display:flex><span>bind_addr = <span style=color:#ba2121>&#34;0.0.0.0&#34;</span>
</span></span><span style=display:flex><span>http_port = <span style=color:#666>5440</span>
</span></span><span style=display:flex><span>grpc_port = <span style=color:#666>8831</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[logger]
</span></span><span style=display:flex><span>level = <span style=color:#ba2121>&#34;info&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[tracing]
</span></span><span style=display:flex><span>dir = <span style=color:#ba2121>&#34;/tmp/horaedb&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[analytic.storage.object_store]
</span></span><span style=display:flex><span>type = <span style=color:#ba2121>&#34;Local&#34;</span>
</span></span><span style=display:flex><span>data_dir = <span style=color:#ba2121>&#34;/tmp/horaedb&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[analytic.wal]
</span></span><span style=display:flex><span>type = <span style=color:#ba2121>&#34;RocksDB&#34;</span>
</span></span><span style=display:flex><span>data_dir = <span style=color:#ba2121>&#34;/tmp/horaedb&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>In order to deploy two HoraeDB instances on the same machine, the config should choose different ports to serve and data directories to store data.</p><p>Say the <code>HoraeDB_0</code>&rsquo;s config is:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[server]
</span></span><span style=display:flex><span>bind_addr = <span style=color:#ba2121>&#34;0.0.0.0&#34;</span>
</span></span><span style=display:flex><span>http_port = <span style=color:#666>5440</span>
</span></span><span style=display:flex><span>grpc_port = <span style=color:#666>8831</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[logger]
</span></span><span style=display:flex><span>level = <span style=color:#ba2121>&#34;info&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[tracing]
</span></span><span style=display:flex><span>dir = <span style=color:#ba2121>&#34;/tmp/horaedb_0&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[analytic.storage.object_store]
</span></span><span style=display:flex><span>type = <span style=color:#ba2121>&#34;Local&#34;</span>
</span></span><span style=display:flex><span>data_dir = <span style=color:#ba2121>&#34;/tmp/horaedb_0&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[analytic.wal]
</span></span><span style=display:flex><span>type = <span style=color:#ba2121>&#34;RocksDB&#34;</span>
</span></span><span style=display:flex><span>data_dir = <span style=color:#ba2121>&#34;/tmp/horaedb_0&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>Then the <code>HoraeDB_1</code>&rsquo;s config is:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[server]
</span></span><span style=display:flex><span>bind_addr = <span style=color:#ba2121>&#34;0.0.0.0&#34;</span>
</span></span><span style=display:flex><span>http_port = <span style=color:#666>15440</span>
</span></span><span style=display:flex><span>grpc_port = <span style=color:#666>18831</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[logger]
</span></span><span style=display:flex><span>level = <span style=color:#ba2121>&#34;info&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[tracing]
</span></span><span style=display:flex><span>dir = <span style=color:#ba2121>&#34;/tmp/horaedb_1&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[analytic.storage.object_store]
</span></span><span style=display:flex><span>type = <span style=color:#ba2121>&#34;Local&#34;</span>
</span></span><span style=display:flex><span>data_dir = <span style=color:#ba2121>&#34;/tmp/horaedb_1&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[analytic.wal]
</span></span><span style=display:flex><span>type = <span style=color:#ba2121>&#34;RocksDB&#34;</span>
</span></span><span style=display:flex><span>data_dir = <span style=color:#ba2121>&#34;/tmp/horaedb_1&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=schemashard-declaration>Schema&amp;Shard Declaration</h3><p>Then we should define the common part &ndash; schema&amp;shard declaration and routing rules.</p><p>Here is the config for schema&amp;shard declaration:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[cluster_deployment]
</span></span><span style=display:flex><span>mode = <span style=color:#ba2121>&#34;NoMeta&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[[cluster_deployment.topology.schema_shards]]
</span></span><span style=display:flex><span>schema = <span style=color:#ba2121>&#39;public_0&#39;</span>
</span></span><span style=display:flex><span>[[cluster_deployment.topology.schema_shards.shard_views]]
</span></span><span style=display:flex><span>shard_id = <span style=color:#666>0</span>
</span></span><span style=display:flex><span>[cluster_deployment.topology.schema_shards.shard_views.endpoint]
</span></span><span style=display:flex><span>addr = <span style=color:#ba2121>&#39;127.0.0.1&#39;</span>
</span></span><span style=display:flex><span>port = <span style=color:#666>8831</span>
</span></span><span style=display:flex><span>[[cluster_deployment.topology.schema_shards.shard_views]]
</span></span><span style=display:flex><span>shard_id = <span style=color:#666>1</span>
</span></span><span style=display:flex><span>[cluster_deployment.topology.schema_shards.shard_views.endpoint]
</span></span><span style=display:flex><span>addr = <span style=color:#ba2121>&#39;127.0.0.1&#39;</span>
</span></span><span style=display:flex><span>port = <span style=color:#666>8831</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[[cluster_deployment.topology.schema_shards]]
</span></span><span style=display:flex><span>schema = <span style=color:#ba2121>&#39;public_1&#39;</span>
</span></span><span style=display:flex><span>[[cluster_deployment.topology.schema_shards.shard_views]]
</span></span><span style=display:flex><span>shard_id = <span style=color:#666>0</span>
</span></span><span style=display:flex><span>[cluster_deployment.topology.schema_shards.shard_views.endpoint]
</span></span><span style=display:flex><span>addr = <span style=color:#ba2121>&#39;127.0.0.1&#39;</span>
</span></span><span style=display:flex><span>port = <span style=color:#666>8831</span>
</span></span><span style=display:flex><span>[[cluster_deployment.topology.schema_shards.shard_views]]
</span></span><span style=display:flex><span>shard_id = <span style=color:#666>1</span>
</span></span><span style=display:flex><span>[cluster_deployment.topology.schema_shards.shard_views.endpoint]
</span></span><span style=display:flex><span>addr = <span style=color:#ba2121>&#39;127.0.0.1&#39;</span>
</span></span><span style=display:flex><span>port = <span style=color:#666>18831</span>
</span></span></code></pre></td></tr></table></div></div><p>In the config above, two schemas are declared:</p><ul><li><code>public_0</code> has two shards served by <code>HoraeDB_0</code>.</li><li><code>public_1</code> has two shards served by both <code>HoraeDB_0</code> and <code>HoraeDB_1</code>.</li></ul><h3 id=routing-rules>Routing Rules</h3><p>Provided with schema&amp;shard declaration, routing rules can be defined and here is an example of prefix rule:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[[cluster_deployment.route_rules.prefix_rules]]
</span></span><span style=display:flex><span>schema = <span style=color:#ba2121>&#39;public_0&#39;</span>
</span></span><span style=display:flex><span>prefix = <span style=color:#ba2121>&#39;prod_&#39;</span>
</span></span><span style=display:flex><span>shard = <span style=color:#666>0</span>
</span></span></code></pre></td></tr></table></div></div><p>This rule means that all the table with <code>prod_</code> prefix belonging to <code>public_0</code> should be routed to <code>shard_0</code> of <code>public_0</code>, that is to say, <code>HoraeDB_0</code>. As for the other tables whose names are not prefixed by <code>prod_</code> will be routed by hash to both <code>shard_0</code> and <code>shard_1</code> of <code>public_0</code>.</p><p>Besides prefix rule, we can also define a hash rule:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[[cluster_deployment.route_rules.hash_rules]]
</span></span><span style=display:flex><span>schema = <span style=color:#ba2121>&#39;public_1&#39;</span>
</span></span><span style=display:flex><span>shards = [<span style=color:#666>0</span>, <span style=color:#666>1</span>]
</span></span></code></pre></td></tr></table></div></div><p>This rule tells HoraeDB to route <code>public_1</code>&rsquo;s tables to both <code>shard_0</code> and <code>shard_1</code> of <code>public_1</code>, that is to say, <code>HoraeDB0</code> and <code>HoraeDB_1</code>. And actually this is default routing behavior if no such rule provided for schema <code>public_1</code>.</p><p>For now, we can provide the full example config for <code>HoraeDB_0</code> and <code>HoraeDB_1</code>:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[server]
</span></span><span style=display:flex><span>bind_addr = <span style=color:#ba2121>&#34;0.0.0.0&#34;</span>
</span></span><span style=display:flex><span>http_port = <span style=color:#666>5440</span>
</span></span><span style=display:flex><span>grpc_port = <span style=color:#666>8831</span>
</span></span><span style=display:flex><span>mysql_port = <span style=color:#666>3307</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[logger]
</span></span><span style=display:flex><span>level = <span style=color:#ba2121>&#34;info&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[tracing]
</span></span><span style=display:flex><span>dir = <span style=color:#ba2121>&#34;/tmp/horaedb_0&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[analytic.storage.object_store]
</span></span><span style=display:flex><span>type = <span style=color:#ba2121>&#34;Local&#34;</span>
</span></span><span style=display:flex><span>data_dir = <span style=color:#ba2121>&#34;/tmp/horaedb_0&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[analytic.wal]
</span></span><span style=display:flex><span>type = <span style=color:#ba2121>&#34;RocksDB&#34;</span>
</span></span><span style=display:flex><span>data_dir = <span style=color:#ba2121>&#34;/tmp/horaedb_0&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[cluster_deployment]
</span></span><span style=display:flex><span>mode = <span style=color:#ba2121>&#34;NoMeta&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[[cluster_deployment.topology.schema_shards]]
</span></span><span style=display:flex><span>schema = <span style=color:#ba2121>&#39;public_0&#39;</span>
</span></span><span style=display:flex><span>[[cluster_deployment.topology.schema_shards.shard_views]]
</span></span><span style=display:flex><span>shard_id = <span style=color:#666>0</span>
</span></span><span style=display:flex><span>[cluster_deployment.topology.schema_shards.shard_views.endpoint]
</span></span><span style=display:flex><span>addr = <span style=color:#ba2121>&#39;127.0.0.1&#39;</span>
</span></span><span style=display:flex><span>port = <span style=color:#666>8831</span>
</span></span><span style=display:flex><span>[[cluster_deployment.topology.schema_shards.shard_views]]
</span></span><span style=display:flex><span>shard_id = <span style=color:#666>1</span>
</span></span><span style=display:flex><span>[cluster_deployment.topology.schema_shards.shard_views.endpoint]
</span></span><span style=display:flex><span>addr = <span style=color:#ba2121>&#39;127.0.0.1&#39;</span>
</span></span><span style=display:flex><span>port = <span style=color:#666>8831</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[[cluster_deployment.topology.schema_shards]]
</span></span><span style=display:flex><span>schema = <span style=color:#ba2121>&#39;public_1&#39;</span>
</span></span><span style=display:flex><span>[[cluster_deployment.topology.schema_shards.shard_views]]
</span></span><span style=display:flex><span>shard_id = <span style=color:#666>0</span>
</span></span><span style=display:flex><span>[cluster_deployment.topology.schema_shards.shard_views.endpoint]
</span></span><span style=display:flex><span>addr = <span style=color:#ba2121>&#39;127.0.0.1&#39;</span>
</span></span><span style=display:flex><span>port = <span style=color:#666>8831</span>
</span></span><span style=display:flex><span>[[cluster_deployment.topology.schema_shards.shard_views]]
</span></span><span style=display:flex><span>shard_id = <span style=color:#666>1</span>
</span></span><span style=display:flex><span>[cluster_deployment.topology.schema_shards.shard_views.endpoint]
</span></span><span style=display:flex><span>addr = <span style=color:#ba2121>&#39;127.0.0.1&#39;</span>
</span></span><span style=display:flex><span>port = <span style=color:#666>18831</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[server]
</span></span><span style=display:flex><span>bind_addr = <span style=color:#ba2121>&#34;0.0.0.0&#34;</span>
</span></span><span style=display:flex><span>http_port = <span style=color:#666>15440</span>
</span></span><span style=display:flex><span>grpc_port = <span style=color:#666>18831</span>
</span></span><span style=display:flex><span>mysql_port = <span style=color:#666>13307</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[logger]
</span></span><span style=display:flex><span>level = <span style=color:#ba2121>&#34;info&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[tracing]
</span></span><span style=display:flex><span>dir = <span style=color:#ba2121>&#34;/tmp/horaedb_1&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[analytic.storage.object_store]
</span></span><span style=display:flex><span>type = <span style=color:#ba2121>&#34;Local&#34;</span>
</span></span><span style=display:flex><span>data_dir = <span style=color:#ba2121>&#34;/tmp/horaedb_1&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[analytic.wal]
</span></span><span style=display:flex><span>type = <span style=color:#ba2121>&#34;RocksDB&#34;</span>
</span></span><span style=display:flex><span>data_dir = <span style=color:#ba2121>&#34;/tmp/horaedb_1&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[cluster_deployment]
</span></span><span style=display:flex><span>mode = <span style=color:#ba2121>&#34;NoMeta&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[[cluster_deployment.topology.schema_shards]]
</span></span><span style=display:flex><span>schema = <span style=color:#ba2121>&#39;public_0&#39;</span>
</span></span><span style=display:flex><span>[[cluster_deployment.topology.schema_shards.shard_views]]
</span></span><span style=display:flex><span>shard_id = <span style=color:#666>0</span>
</span></span><span style=display:flex><span>[cluster_deployment.topology.schema_shards.shard_views.endpoint]
</span></span><span style=display:flex><span>addr = <span style=color:#ba2121>&#39;127.0.0.1&#39;</span>
</span></span><span style=display:flex><span>port = <span style=color:#666>8831</span>
</span></span><span style=display:flex><span>[[cluster_deployment.topology.schema_shards.shard_views]]
</span></span><span style=display:flex><span>shard_id = <span style=color:#666>1</span>
</span></span><span style=display:flex><span>[cluster_deployment.topology.schema_shards.shard_views.endpoint]
</span></span><span style=display:flex><span>addr = <span style=color:#ba2121>&#39;127.0.0.1&#39;</span>
</span></span><span style=display:flex><span>port = <span style=color:#666>8831</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[[cluster_deployment.topology.schema_shards]]
</span></span><span style=display:flex><span>schema = <span style=color:#ba2121>&#39;public_1&#39;</span>
</span></span><span style=display:flex><span>[[cluster_deployment.topology.schema_shards.shard_views]]
</span></span><span style=display:flex><span>shard_id = <span style=color:#666>0</span>
</span></span><span style=display:flex><span>[cluster_deployment.topology.schema_shards.shard_views.endpoint]
</span></span><span style=display:flex><span>addr = <span style=color:#ba2121>&#39;127.0.0.1&#39;</span>
</span></span><span style=display:flex><span>port = <span style=color:#666>8831</span>
</span></span><span style=display:flex><span>[[cluster_deployment.topology.schema_shards.shard_views]]
</span></span><span style=display:flex><span>shard_id = <span style=color:#666>1</span>
</span></span><span style=display:flex><span>[cluster_deployment.topology.schema_shards.shard_views.endpoint]
</span></span><span style=display:flex><span>addr = <span style=color:#ba2121>&#39;127.0.0.1&#39;</span>
</span></span><span style=display:flex><span>port = <span style=color:#666>18831</span>
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s name the two different config files as <code>config_0.toml</code> and <code>config_1.toml</code> but you should know in the real environment the different HoraeDB instances can be deployed across different machines, that is to say, there is no need to choose different ports and data directories for different HoraeDB instances so that all the HoraeDB instances can share one exactly <strong>same</strong> config file.</p><h2 id=start-horaedbs>Start HoraeDBs</h2><p>After the configs are prepared, what we should to do is to start HoraeDB container with the specific config.</p><p>Just run the commands below:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo docker run -d -t --name horaedb_0 -p 5440:5440 -p 8831:8831 -v <span style=color:green;font-weight:700>$(</span><span style=color:green>pwd</span><span style=color:green;font-weight:700>)</span>/config_0.toml:/etc/horaedb/horaedb.toml horaedb/horaedb-server
</span></span><span style=display:flex><span>sudo docker run -d -t --name horaedb_1 -p 15440:15440 -p 18831:18831 -v <span style=color:green;font-weight:700>$(</span><span style=color:green>pwd</span><span style=color:green;font-weight:700>)</span>/config_1.toml:/etc/horaedb/horaedb.toml horaedb/horaedb-server
</span></span></code></pre></td></tr></table></div></div><p>After the two containers are created and starting running, read and write requests can be served by the two-instances HoraeDB cluster.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-f8177b6910dfd52c70228b40053918c4>2 - WithMeta</h1><p>This guide shows how to deploy a HoraeDB cluster with HoraeMeta. And with the HoraeMeta, the whole HoraeDB cluster will feature: high availability, load balancing and horizontal scalability if the underlying storage used by HoraeDB is separated service.</p><h2 id=deploy-horaemeta>Deploy HoraeMeta</h2><h3 id=introduce>Introduce</h3><p>HoraeMeta is one of the core services of HoraeDB distributed mode, it is used to manage and schedule the HoraeDB cluster. By the way, the high availability of HoraeMeta is ensured by embedding <a href=https://github.com/etcd-io/etcd>ETCD</a>. Also, the ETCD service is provided for HoraeDB servers to manage the distributed shard locks.</p><h3 id=build>Build</h3><ul><li>Golang version >= 1.19.</li><li>run <code>make build</code> in root path of <a href=https://github.com/apache/horaedb/tree/main/horaemeta>HoraeMeta</a>.</li></ul><h3 id=deploy>Deploy</h3><h4 id=config>Config</h4><p>At present, HoraeMeta supports specifying service startup configuration in two ways: configuration file and environment variable. We provide an example of configuration file startup. For details, please refer to <a href=https://github.com/apache/horaedb/tree/main/horaemeta/config>config</a>. The configuration priority of environment variables is higher than that of configuration files. When they exist at the same time, the environment variables shall prevail.</p><h4 id=dynamic-or-static>Dynamic or Static</h4><p>Even with the HoraeMeta, the HoraeDB cluster can be deployed with a static or a dynamic topology. With a static topology, the table distribution is static after the cluster is initialized while with the dynamic topology, the tables can migrate between different HoraeDB nodes to achieve load balance or failover. However, the dynamic topology can be enabled only if the storage used by the HoraeDB node is remote, otherwise the data may be corrupted when tables are transferred to a different HoraeDB node when the data of HoraeDB is persisted locally.</p><p>Currently, the dynamic scheduling over the cluster topology is disabled by default in HoraeMeta, and in this guide, we won&rsquo;t enable it because local storage is adopted here. If you want to enable the dynamic scheduling, the <code>TOPOLOGY_TYPE</code> can be set as <code>dynamic</code> (<code>static</code> by default), and after that, load balancing and failover will work. However, don&rsquo;t enable it if what the underlying storage is local disk.</p><p>With the static topology, the params <code>DEFAULT_CLUSTER_NODE_COUNT</code>, which denotes the number of the HoraeDB nodes in the deployed cluster and should be set to the real number of machines for HoraeDB server, matters a lot because after cluster initialization the HoraeDB nodes can&rsquo;t be changed any more.</p><h4 id=start-horaemeta-instances>Start HoraeMeta Instances</h4><p>HoraeMeta is based on etcd to achieve high availability. In product environment, we usually deploy multiple nodes, but in local environment and testing, we can directly deploy a single node to simplify the entire deployment process.</p><ul><li>Standalone</li></ul><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d --name horaemeta-server <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>  -p 2379:2379 <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>  ghcr.io/apache/horaemeta-server:nightly-20231225-ab067bf0
</span></span></code></pre></td></tr></table></div></div><ul><li>Cluster</li></ul><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://horaedb.apache.org/config-horaemeta-cluster0.toml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker run -d --network<span style=color:#666>=</span>host --name horaemeta-server0 <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>  -v <span style=color:green;font-weight:700>$(</span><span style=color:green>pwd</span><span style=color:green;font-weight:700>)</span>/config-horaemeta-cluster0.toml:/etc/horaemeta/horaemeta.toml <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>  ghcr.io/apache/horaemeta-server:nightly-20231225-ab067bf0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>wget https://horaedb.apache.org/config-horaemeta-cluster1.toml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker run -d --network<span style=color:#666>=</span>host --name horaemeta-server1 <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>  -v <span style=color:green;font-weight:700>$(</span><span style=color:green>pwd</span><span style=color:green;font-weight:700>)</span>/config-horaemeta-cluster1.toml:/etc/horaemeta/horaemeta.toml <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>  ghcr.io/apache/horaemeta-server:nightly-20231225-ab067bf0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>wget https://horaedb.apache.org/config-horaemeta-cluster2.toml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker run -d --network<span style=color:#666>=</span>host --name horaemeta-server2 <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>  -v <span style=color:green;font-weight:700>$(</span><span style=color:green>pwd</span><span style=color:green;font-weight:700>)</span>/config-horaemeta-cluster2.toml:/etc/horaemeta/horaemeta.toml <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>  ghcr.io/apache/horaemeta-server:nightly-20231225-ab067bf0
</span></span></code></pre></td></tr></table></div></div><p>And if the storage used by the HoraeDB is remote and you want to enable the dynamic schedule features of the HoraeDB cluster, the <code>-e TOPOLOGY_TYPE=dynamic</code> can be added to the docker run command.</p><h2 id=deploy-horaedb>Deploy HoraeDB</h2><p>In the <code>NoMeta</code> mode, HoraeDB only requires the local disk as the underlying storage because the topology of the HoraeDB cluster is static. However, with HoraeMeta, the cluster topology can be dynamic, that is to say, HoraeDB can be configured to use a non-local storage service for the features of a distributed system: HA, load balancing, scalability and so on. And HoraeDB can be still configured to use a local storage with HoraeMeta, which certainly leads to a static cluster topology.</p><p>The relevant storage configurations include two parts:</p><ul><li>Object Storage</li><li>WAL Storage</li></ul><p>Note: If you are deploying HoraeDB over multiple nodes in a production environment, please set the environment variable for the server address as follows:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:green>export</span> <span style=color:#19177c>HORAEDB_SERVER_ADDR</span><span style=color:#666>=</span><span style=color:#ba2121>&#34;{server_address}:8831&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>This address is used for communication between HoraeMeta and HoraeDB, please ensure it is valid.</p><h3 id=object-storage>Object Storage</h3><h4 id=local-storage>Local Storage</h4><p>Similarly, we can configure HoraeDB to use a local disk as the underlying storage:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[analytic.storage.object_store]
</span></span><span style=display:flex><span>type = <span style=color:#ba2121>&#34;Local&#34;</span>
</span></span><span style=display:flex><span>data_dir = <span style=color:#ba2121>&#34;/home/admin/data/horaedb&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=oss>OSS</h4><p>Aliyun OSS can be also used as the underlying storage for HoraeDB, with which the data is replicated for disaster recovery. Here is a example config, and you have to replace the templates with the real OSS parameters:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[analytic.storage.object_store]
</span></span><span style=display:flex><span>type = <span style=color:#ba2121>&#34;Aliyun&#34;</span>
</span></span><span style=display:flex><span>key_id = <span style=color:#ba2121>&#34;{key_id}&#34;</span>
</span></span><span style=display:flex><span>key_secret = <span style=color:#ba2121>&#34;{key_secret}&#34;</span>
</span></span><span style=display:flex><span>endpoint = <span style=color:#ba2121>&#34;{endpoint}&#34;</span>
</span></span><span style=display:flex><span>bucket = <span style=color:#ba2121>&#34;{bucket}&#34;</span>
</span></span><span style=display:flex><span>prefix = <span style=color:#ba2121>&#34;{data_dir}&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=s3>S3</h4><p>Amazon S3 can be also used as the underlying storage for HoraeDB. Here is a example config, and you have to replace the templates with the real S3 parameters:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[analytic.storage.object_store]
</span></span><span style=display:flex><span>type = <span style=color:#ba2121>&#34;S3&#34;</span>
</span></span><span style=display:flex><span>region = <span style=color:#ba2121>&#34;{region}&#34;</span>
</span></span><span style=display:flex><span>key_id = <span style=color:#ba2121>&#34;{key_id}&#34;</span>
</span></span><span style=display:flex><span>key_secret = <span style=color:#ba2121>&#34;{key_secret}&#34;</span>
</span></span><span style=display:flex><span>endpoint = <span style=color:#ba2121>&#34;{endpoint}&#34;</span>
</span></span><span style=display:flex><span>bucket = <span style=color:#ba2121>&#34;{bucket}&#34;</span>
</span></span><span style=display:flex><span>prefix = <span style=color:#ba2121>&#34;{prefix}&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=wal-storage>WAL Storage</h3><h4 id=rocksdb>RocksDB</h4><p>The WAL based on RocksDB is also a kind of local storage for HoraeDB, which is easy for a quick start:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[analytic.wal]
</span></span><span style=display:flex><span>type = <span style=color:#ba2121>&#34;RocksDB&#34;</span>
</span></span><span style=display:flex><span>data_dir = <span style=color:#ba2121>&#34;/home/admin/data/horaedb&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=oceanbase>OceanBase</h4><p>If you have deployed a OceanBase cluster, HoraeDB can use it as the WAL storage for data disaster recovery. Here is a example config for such WAL, and you have to replace the templates with real OceanBase parameters:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[analytic.wal]
</span></span><span style=display:flex><span>type = <span style=color:#ba2121>&#34;Obkv&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[analytic.wal.data_namespace]
</span></span><span style=display:flex><span>ttl = <span style=color:#ba2121>&#34;365d&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[analytic.wal.obkv]
</span></span><span style=display:flex><span>full_user_name = <span style=color:#ba2121>&#34;{full_user_name}&#34;</span>
</span></span><span style=display:flex><span>param_url = <span style=color:#ba2121>&#34;{param_url}&#34;</span>
</span></span><span style=display:flex><span>password = <span style=color:#ba2121>&#34;{password}&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[analytic.wal.obkv.client]
</span></span><span style=display:flex><span>sys_user_name = <span style=color:#ba2121>&#34;{sys_user_name}&#34;</span>
</span></span><span style=display:flex><span>sys_password = <span style=color:#ba2121>&#34;{sys_password}&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=kafka>Kafka</h4><p>If you have deployed a Kafka cluster, HoraeDB can also use it as the WAL storage. Here is example config for it, and you have to replace the templates with real parameters of the Kafka cluster:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[analytic.wal]
</span></span><span style=display:flex><span>type = <span style=color:#ba2121>&#34;Kafka&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[analytic.wal.kafka.client]
</span></span><span style=display:flex><span>boost_brokers = [ <span style=color:#ba2121>&#34;{boost_broker1}&#34;</span>, <span style=color:#ba2121>&#34;{boost_broker2}&#34;</span> ]
</span></span></code></pre></td></tr></table></div></div><h3 id=meta-client-config>Meta Client Config</h3><p>Besides the storage configurations, HoraeDB must be configured to start in <code>WithMeta</code> mode and connect to the deployed HoraeMeta:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[cluster_deployment]
</span></span><span style=display:flex><span>mode = <span style=color:#ba2121>&#34;WithMeta&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[cluster_deployment.meta_client]
</span></span><span style=display:flex><span>cluster_name = <span style=color:#ba2121>&#39;defaultCluster&#39;</span>
</span></span><span style=display:flex><span>meta_addr = <span style=color:#ba2121>&#39;http://{HoraeMetaAddr}:2379&#39;</span>
</span></span><span style=display:flex><span>lease = <span style=color:#ba2121>&#34;10s&#34;</span>
</span></span><span style=display:flex><span>timeout = <span style=color:#ba2121>&#34;5s&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[cluster_deployment.etcd_client]
</span></span><span style=display:flex><span>server_addrs = [<span style=color:#ba2121>&#39;http://{HoraeMetaAddr}:2379&#39;</span>]
</span></span></code></pre></td></tr></table></div></div><h3 id=compaction-offload>Compaction Offload</h3><p>Compaction offload is also supported. To enable compaction offload, the corresponding compaction mode with node picker and endpoint should be configured.</p><ul><li><code>node_picker</code>: There are two types of node picker &ndash; <code>Local</code> and <code>Remote</code>(WIP).<ul><li>When the <code>Local</code> is setted, the local compaction task would be offloaded to the specific remote compaction server, which decided by <code>endpoint</code>.</li></ul></li><li><code>endpoint</code>: The endpoint, in the form <code>addr:port</code>, indicating the <em>grpc port</em> of the remote compaction server.</li></ul><p>Here is an example for it:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[analytic.compaction_mode]
</span></span><span style=display:flex><span>compaction_mode = <span style=color:#ba2121>&#34;Offload&#34;</span>
</span></span><span style=display:flex><span>node_picker = <span style=color:#ba2121>&#34;Local&#34;</span>
</span></span><span style=display:flex><span>endpoint = <span style=color:#ba2121>&#34;{RemoteCompactionServerAddr}:{RemoteCompactionServerGrpcPort}&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>A Compaction Server, responsible for executing the compaction task, is also needed. Currently <code>horaedb-server</code> will act as this role, in the future we can move it to an independent service.</p><h3 id=complete-config-of-horaedb>Complete Config of HoraeDB</h3><p>With all the parts of the configurations mentioned above, a runnable complete config for HoraeDB can be made. In order to make the HoraeDB cluster runnable, we can decide to adopt RocksDB-based WAL and local-disk-based Object Storage without compaction offload:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[server]
</span></span><span style=display:flex><span>bind_addr = <span style=color:#ba2121>&#34;0.0.0.0&#34;</span>
</span></span><span style=display:flex><span>http_port = <span style=color:#666>5440</span>
</span></span><span style=display:flex><span>grpc_port = <span style=color:#666>8831</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[logger]
</span></span><span style=display:flex><span>level = <span style=color:#ba2121>&#34;info&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[runtime]
</span></span><span style=display:flex><span>read_thread_num = <span style=color:#666>20</span>
</span></span><span style=display:flex><span>write_thread_num = <span style=color:#666>16</span>
</span></span><span style=display:flex><span>background_thread_num = <span style=color:#666>12</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[cluster_deployment]
</span></span><span style=display:flex><span>mode = <span style=color:#ba2121>&#34;WithMeta&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[cluster_deployment.meta_client]
</span></span><span style=display:flex><span>cluster_name = <span style=color:#ba2121>&#39;defaultCluster&#39;</span>
</span></span><span style=display:flex><span>meta_addr = <span style=color:#ba2121>&#39;http://127.0.0.1:2379&#39;</span>
</span></span><span style=display:flex><span>lease = <span style=color:#ba2121>&#34;10s&#34;</span>
</span></span><span style=display:flex><span>timeout = <span style=color:#ba2121>&#34;5s&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[cluster_deployment.etcd_client]
</span></span><span style=display:flex><span>server_addrs = [<span style=color:#ba2121>&#39;127.0.0.1:2379&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[analytic]
</span></span><span style=display:flex><span>write_group_worker_num = <span style=color:#666>16</span>
</span></span><span style=display:flex><span>replay_batch_size = <span style=color:#666>100</span>
</span></span><span style=display:flex><span>max_replay_tables_per_batch = <span style=color:#666>128</span>
</span></span><span style=display:flex><span>write_group_command_channel_cap = <span style=color:#666>1024</span>
</span></span><span style=display:flex><span>sst_background_read_parallelism = <span style=color:#666>8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[analytic.manifest]
</span></span><span style=display:flex><span>scan_batch_size = <span style=color:#666>100</span>
</span></span><span style=display:flex><span>snapshot_every_n_updates = <span style=color:#666>10000</span>
</span></span><span style=display:flex><span>scan_timeout = <span style=color:#ba2121>&#34;5s&#34;</span>
</span></span><span style=display:flex><span>store_timeout = <span style=color:#ba2121>&#34;5s&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[analytic.wal]
</span></span><span style=display:flex><span>type = <span style=color:#ba2121>&#34;RocksDB&#34;</span>
</span></span><span style=display:flex><span>data_dir = <span style=color:#ba2121>&#34;/home/admin/data/horaedb&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[analytic.storage]
</span></span><span style=display:flex><span>mem_cache_capacity = <span style=color:#ba2121>&#34;20GB&#34;</span>
</span></span><span style=display:flex><span><span style=color:#408080;font-style:italic># 1&lt;&lt;8=256</span>
</span></span><span style=display:flex><span>mem_cache_partition_bits = <span style=color:#666>8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[analytic.storage.object_store]
</span></span><span style=display:flex><span>type = <span style=color:#ba2121>&#34;Local&#34;</span>
</span></span><span style=display:flex><span>data_dir = <span style=color:#ba2121>&#34;/home/admin/data/horaedb/&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[analytic.table_opts]
</span></span><span style=display:flex><span>arena_block_size = <span style=color:#666>2097152</span>
</span></span><span style=display:flex><span>write_buffer_size = <span style=color:#666>33554432</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[analytic.compaction]
</span></span><span style=display:flex><span>schedule_channel_len = <span style=color:#666>16</span>
</span></span><span style=display:flex><span>schedule_interval = <span style=color:#ba2121>&#34;30m&#34;</span>
</span></span><span style=display:flex><span>max_ongoing_tasks = <span style=color:#666>8</span>
</span></span><span style=display:flex><span>memory_limit = <span style=color:#ba2121>&#34;4G&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s name this config file as <code>config.toml</code>. And the example configs, in which the templates must be replaced with real parameters before use, for remote storages are also provided:</p><ul><li><a href=../../resources/config_local_oss.toml>RocksDB WAL + OSS</a></li><li><a href=../../resources/config_obkv_oss.toml>OceanBase WAL + OSS</a></li><li><a href=../../resources/config_kafka_oss.toml>Kafka WAL + OSS</a></li></ul><h2 id=run-horaedb-cluster-with-horaemeta>Run HoraeDB cluster with HoraeMeta</h2><p>Firstly, let&rsquo;s start the HoraeMeta:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d --name horaemeta-server <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>  -p 2379:2379 <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>  ghcr.io/apache/horaemeta-server:nightly-20231225-ab067bf0
</span></span></code></pre></td></tr></table></div></div><p>With the started HoraeMeta cluster, let&rsquo;s start the HoraeDB instance:
TODO: complete it later</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class=td-footer__center>Apache HoraeDB is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.<hr><span class=td-footer__copyright>&copy;
2023&ndash;2024
<span class=td-footer__authors><p>The Apache Software Foundation, Licensed under the Apache License, Version 2.0.</p><p>Apache, the names of Apache projects, and the feather logo are either registered trademarks or trademarks of the Apache Software Foundation in the United States and/or other countries.</p></span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div><hr><div class="row mx-md-2"><div class=td-footer__center><span class=td-footer__copyright>Found a bug in website? <a href=https://github.com/apache/horaedb-docs/issues/new>Open an issue</a> or <a href=https://github.com/apache/horaedb-docs/pulls>submit a pull request</a> on GitHub.</span></div></div><hr></div></footer></div><script src=/js/main.min.f72d00502781aaf278a14088eb2356b1ba2a05ad698a0c43fe86314d74ceab56.js integrity="sha256-9y0AUCeBqvJ4oUCI6yNWsboqBa1pigxD/oYxTXTOq1Y=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>