<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">

<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>WithMeta Mode - HoraeDB Documentation</title>


    <!-- Custom HTML head -->
    
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff" />

    <link rel="icon" href="../favicon.svg">
    <link rel="shortcut icon" href="../favicon.png">
    <link rel="stylesheet" href="../css/variables.css">
    <link rel="stylesheet" href="../css/general.css">
    <link rel="stylesheet" href="../css/chrome.css">
    <link rel="stylesheet" href="../css/print.css" media="print">

    <!-- Fonts -->
    <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
    <link rel="stylesheet" href="../fonts/fonts.css">

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="../highlight.css">
    <link rel="stylesheet" href="../tomorrow-night.css">
    <link rel="stylesheet" href="../ayu-highlight.css">

    <!-- Custom theme stylesheets -->
    <link rel="stylesheet" href="../style.css">

</head>

<body>
    <!-- Provide site root to javascript -->
    <script>
        var path_to_root = "../";
        var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
    </script>

    <!-- Work around some values being stored in localStorage wrapped in quotes -->
    <script>
        try {
            var theme = localStorage.getItem('mdbook-theme');
            var sidebar = localStorage.getItem('mdbook-sidebar');

            if (theme.startsWith('"') && theme.endsWith('"')) {
                localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
            }

            if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
            }
        } catch (e) { }
    </script>

    <!-- Set the theme before any content is loaded, prevents flash -->
    <script>
        var theme;
        try { theme = localStorage.getItem('mdbook-theme'); } catch (e) { }
        if (theme === null || theme === undefined) { theme = default_theme; }
        var html = document.querySelector('html');
        html.classList.remove('no-js')
        html.classList.remove('light')
        html.classList.add(theme);
        html.classList.add('js');
    </script>

    <!-- Hide / unhide sidebar before it is displayed -->
    <script>
        var html = document.querySelector('html');
        var sidebar = 'hidden';
        if (document.body.clientWidth >= 1080) {
            try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch (e) { }
            sidebar = sidebar || 'visible';
        }
        html.classList.remove('sidebar-visible');
        html.classList.add("sidebar-" + sidebar);
    </script>

    <nav id="sidebar" class="sidebar" aria-label="Table of contents">
        <div class="sidebar-scrollbox">
            <ol class="chapter"><li class="chapter-item affix "><li class="part-title">Introduction</li><li class="chapter-item "><a href="../about.html"><strong aria-hidden="true">1.</strong> What is HoraeDB</a></li><li class="chapter-item "><a href="../quick_start.html"><strong aria-hidden="true">2.</strong> Quick Start</a></li><li class="chapter-item affix "><li class="part-title">User Guide</li><li class="chapter-item "><a href="../sql/README.html"><strong aria-hidden="true">3.</strong> SQL Syntax</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../sql/model/README.html"><strong aria-hidden="true">3.1.</strong> Data Model</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../sql/model/data_types.html"><strong aria-hidden="true">3.1.1.</strong> Data Types</a></li><li class="chapter-item "><a href="../sql/model/special_columns.html"><strong aria-hidden="true">3.1.2.</strong> Special Columns</a></li></ol></li><li class="chapter-item "><a href="../sql/identifier.html"><strong aria-hidden="true">3.2.</strong> Identifier</a></li><li class="chapter-item "><a href="../sql/ddl/README.html"><strong aria-hidden="true">3.3.</strong> Data Definition Statements</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../sql/ddl/create_table.html"><strong aria-hidden="true">3.3.1.</strong> CREATE TABLE</a></li><li class="chapter-item "><a href="../sql/ddl/alter_table.html"><strong aria-hidden="true">3.3.2.</strong> ALTER TABLE</a></li><li class="chapter-item "><a href="../sql/ddl/drop_table.html"><strong aria-hidden="true">3.3.3.</strong> DROP TABLE</a></li></ol></li><li class="chapter-item "><a href="../sql/dml/README.html"><strong aria-hidden="true">3.4.</strong> Data Manipulation Statements</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../sql/dml/insert.html"><strong aria-hidden="true">3.4.1.</strong> INSERT</a></li><li class="chapter-item "><a href="../sql/dml/select.html"><strong aria-hidden="true">3.4.2.</strong> SELECT</a></li></ol></li><li class="chapter-item "><a href="../sql/utility.html"><strong aria-hidden="true">3.5.</strong> Utility Statements</a></li><li class="chapter-item "><a href="../sql/engine_options.html"><strong aria-hidden="true">3.6.</strong> Engine Options</a></li><li class="chapter-item "><a href="../sql/functions/scalar_functions.html"><strong aria-hidden="true">3.7.</strong> Scalar Functions</a></li><li class="chapter-item "><a href="../sql/functions/aggregate_functions.html"><strong aria-hidden="true">3.8.</strong> Aggregate Functions</a></li></ol></li><li class="chapter-item expanded "><a href="../cluster_deployment/README.html"><strong aria-hidden="true">4.</strong> Cluster Deployment</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cluster_deployment/platform.html"><strong aria-hidden="true">4.1.</strong> Supported Platform</a></li><li class="chapter-item "><a href="../cluster_deployment/no_meta.html"><strong aria-hidden="true">4.2.</strong> NoMeta Mode</a></li><li class="chapter-item expanded "><a href="../cluster_deployment/with_meta.html" class="active"><strong aria-hidden="true">4.3.</strong> WithMeta Mode</a></li></ol></li><li class="chapter-item "><a href="../sdk/README.html"><strong aria-hidden="true">5.</strong> SDK</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../sdk/java.html"><strong aria-hidden="true">5.1.</strong> Java</a></li><li class="chapter-item "><a href="../sdk/go.html"><strong aria-hidden="true">5.2.</strong> Go</a></li><li class="chapter-item "><a href="../sdk/python.html"><strong aria-hidden="true">5.3.</strong> Python</a></li><li class="chapter-item "><a href="../sdk/rust.html"><strong aria-hidden="true">5.4.</strong> Rust</a></li></ol></li><li class="chapter-item "><a href="../operation/README.html"><strong aria-hidden="true">6.</strong> Operation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../operation/table.html"><strong aria-hidden="true">6.1.</strong> Table</a></li><li class="chapter-item "><a href="../operation/system_table.html"><strong aria-hidden="true">6.2.</strong> System Table</a></li><li class="chapter-item "><a href="../operation/block_list.html"><strong aria-hidden="true">6.3.</strong> Block List</a></li><li class="chapter-item "><a href="../operation/observability.html"><strong aria-hidden="true">6.4.</strong> Observability</a></li><li class="chapter-item "><a href="../operation/horaemeta.html"><strong aria-hidden="true">6.5.</strong> HoraeMeta</a></li></ol></li><li class="chapter-item "><a href="../ecosystem/README.html"><strong aria-hidden="true">7.</strong> Ecosystem</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ecosystem/prometheus.html"><strong aria-hidden="true">7.1.</strong> Prometheus</a></li><li class="chapter-item "><a href="../ecosystem/influxdb.html"><strong aria-hidden="true">7.2.</strong> InfluxDB</a></li><li class="chapter-item "><a href="../ecosystem/opentsdb.html"><strong aria-hidden="true">7.3.</strong> OpenTSDB</a></li></ol></li><li class="chapter-item "><li class="part-title">Dev Guide</li><li class="chapter-item "><a href="../dev/platform.html"><strong aria-hidden="true">8.</strong> Supported Platform</a></li><li class="chapter-item "><a href="../dev/compile_run.html"><strong aria-hidden="true">9.</strong> Compile and Running</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../dev/profiling.html"><strong aria-hidden="true">9.1.</strong> Profile</a></li></ol></li><li class="chapter-item "><a href="../dev/conventional_commit.html"><strong aria-hidden="true">10.</strong> Conventional Commit</a></li><li class="chapter-item "><a href="../dev/style_guide.html"><strong aria-hidden="true">11.</strong> Style guide</a></li><li class="chapter-item "><a href="../dev/roadmap.html"><strong aria-hidden="true">12.</strong> Roadmap</a></li><li class="chapter-item affix "><li class="part-title">Technical and Design</li><li class="chapter-item "><a href="../design/architecture.html"><strong aria-hidden="true">13.</strong> Architecture</a></li><li class="chapter-item "><a href="../design/clustering.html"><strong aria-hidden="true">14.</strong> Cluster</a></li><li class="chapter-item "><a href="../design/storage.html"><strong aria-hidden="true">15.</strong> Storage</a></li><li class="chapter-item "><a href="../design/wal.html"><strong aria-hidden="true">16.</strong> WAL</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../design/wal_on_rocksdb.html"><strong aria-hidden="true">16.1.</strong> WAL on RocksDB</a></li><li class="chapter-item "><a href="../design/wal_on_kafka.html"><strong aria-hidden="true">16.2.</strong> WAL on Kafka</a></li></ol></li><li class="chapter-item "><a href="../design/table_partitioning.html"><strong aria-hidden="true">17.</strong> Table Partitioning</a></li></ol>
        </div>
        <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
    </nav>

    <div id="page-wrapper" class="page-wrapper">

        <div class="page">
                        <div id="menu-bar-hover-placeholder"></div>
            <div id="menu-bar" class="menu-bar sticky bordered">
                <div class="left-buttons">
                    <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents"
                        aria-label="Toggle Table of Contents" aria-controls="sidebar">
                        <i class="fa fa-bars"></i>
                    </button>
                    <button id="theme-toggle" class="icon-button" type="button" title="Change theme"
                        aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                        <i class="fa fa-paint-brush"></i>
                    </button>
                    <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                        <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button>
                        </li>
                    </ul>
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)"
                        aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S"
                        aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
                </div>

                <h1 class="menu-title">HoraeDB Documentation</h1>

                <div class="right-buttons">

                    <button id="lang-toggle" class="icon-button" type="button" title="Change language"
                        aria-label="Change language" aria-haspopup="true" aria-expanded="false"
                        aria-controls="lang-list">
                        <!--                             <i class="fa fa-globe"></i> -->
                        <i>
                            <svg t="1675840511805" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                xmlns="http://www.w3.org/2000/svg" p-id="2677" width="16" height="16">
                                <path
                                    d="M511.573333 85.333333C276.053333 85.333333 85.333333 276.48 85.333333 512s190.72 426.666667 426.24 426.666667C747.52 938.666667 938.666667 747.52 938.666667 512S747.52 85.333333 511.573333 85.333333z m295.68 256h-125.866666a667.733333 667.733333 0 0 0-58.88-151.893333A342.613333 342.613333 0 0 1 807.253333 341.333333zM512 172.373333c35.413333 51.2 63.146667 107.946667 81.493333 168.96h-162.986666c18.346667-61.013333 46.08-117.76 81.493333-168.96zM181.76 597.333333C174.933333 570.026667 170.666667 541.44 170.666667 512s4.266667-58.026667 11.093333-85.333333h144.213333c-3.413333 28.16-5.973333 56.32-5.973333 85.333333 0 29.013333 2.56 57.173333 5.973333 85.333333H181.76z m34.986667 85.333334h125.866666c13.653333 53.333333 33.28 104.533333 58.88 151.893333A340.778667 340.778667 0 0 1 216.746667 682.666667z m125.866666-341.333334H216.746667a340.778667 340.778667 0 0 1 184.746666-151.893333A667.733333 667.733333 0 0 0 342.613333 341.333333zM512 851.626667c-35.413333-51.2-63.146667-107.946667-81.493333-168.96h162.986666c-18.346667 61.013333-46.08 117.76-81.493333 168.96zM611.84 597.333333H412.16c-3.84-28.16-6.826667-56.32-6.826667-85.333333 0-29.013333 2.986667-57.6 6.826667-85.333333h199.68c3.84 27.733333 6.826667 56.32 6.826667 85.333333 0 29.013333-2.986667 57.173333-6.826667 85.333333z m10.666667 237.226667c25.6-47.36 45.226667-98.56 58.88-151.893333h125.866666a342.613333 342.613333 0 0 1-184.746666 151.893333zM698.026667 597.333333c3.413333-28.16 5.973333-56.32 5.973333-85.333333 0-29.013333-2.56-57.173333-5.973333-85.333333h144.213333c6.826667 27.306667 11.093333 55.893333 11.093333 85.333333s-4.266667 58.026667-11.093333 85.333333h-144.213333z"
                                    fill="#000000" fill-opacity=".87" p-id="2678"></path>
                            </svg>
                            <a id="lang_comment"></a>
                        </i>

                    </button>
                    <ul id="lang-list" class="theme-popup" style="left: auto;" aria-label="Languages" role="menu">
                        <li role="none"><button role="menuitem" class="theme" id="en">English</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="cn">中文</button></li>
                    </ul>

                    <a href="../print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>
                    <a href="https://github.com/apache/incubator-horaedb" title="Git repository" aria-label="Git repository">
                        <i id="git-repository-button" class="fa fa-github"></i>
                    </a>
                    <a href="https://github.com/apache/incubator-horaedb-docs/edit/main/docs/src/cluster_deployment/with_meta.md" title="Suggest an edit" aria-label="Suggest an edit">
                        <i id="git-edit-button" class="fa fa-edit"></i>
                    </a>

                </div>
            </div>

            <script>
                window.onload = function () {
                    var path_lang = window.location.pathname.split('/')[1];
                    document.getElementById('lang_comment').innerHTML = path_lang == 'cn' ? "Language" : "语言";
                };
            </script>

            <div id="search-wrapper" class="hidden">
                <form id="searchbar-outer" class="searchbar-outer">
                    <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..."
                        aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                </form>
                <div id="searchresults-outer" class="searchresults-outer hidden">
                    <div id="searchresults-header" class="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
            </div>

            <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
            <script>
                document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                Array.from(document.querySelectorAll('#sidebar a')).forEach(function (link) {
                    link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                });
            </script>

            <div id="content" class="content">
                <main>
                    <!-- Page table of contents -->
                    <div class="sidetoc">
                        <nav class="pagetoc"></nav>
                    </div>

                    <h1 id="withmeta"><a class="header" href="#withmeta">WithMeta</a></h1>
<p>This guide shows how to deploy a HoraeDB cluster with HoraeMeta. And with the HoraeMeta, the whole HoraeDB cluster will feature: high availability, load balancing and horizontal scalability if the underlying storage used by HoraeDB is separated service.</p>
<h2 id="deploy-horaemeta"><a class="header" href="#deploy-horaemeta">Deploy HoraeMeta</a></h2>
<h3 id="introduce"><a class="header" href="#introduce">Introduce</a></h3>
<p>HoraeMeta is one of the core services of HoraeDB distributed mode, it is used to manage and schedule the HoraeDB cluster. By the way, the high availability of HoraeMeta is ensured by embedding <a href="https://github.com/etcd-io/etcd">ETCD</a>. Also, the ETCD service is provided for HoraeDB servers to manage the distributed shard locks.</p>
<h3 id="build"><a class="header" href="#build">Build</a></h3>
<ul>
<li>Golang version &gt;= 1.19.</li>
<li>run <code>make build</code> in root path of <a href="https://github.com/apache/incubator-horaedb-meta">HoraeMeta</a>.</li>
</ul>
<h3 id="deploy"><a class="header" href="#deploy">Deploy</a></h3>
<h4 id="config"><a class="header" href="#config">Config</a></h4>
<p>At present, HoraeMeta supports specifying service startup configuration in two ways: configuration file and environment variable. We provide an example of configuration file startup. For details, please refer to <a href="https://github.com/apache/incubator-horaedb-meta/tree/main/config">config</a>. The configuration priority of environment variables is higher than that of configuration files. When they exist at the same time, the environment variables shall prevail.</p>
<h4 id="dynamic-or-static"><a class="header" href="#dynamic-or-static">Dynamic or Static</a></h4>
<p>Even with the HoraeMeta, the HoraeDB cluster can be deployed with a static or a dynamic topology. With a static topology, the table distribution is static after the cluster is initialized while with the dynamic topology, the tables can migrate between different HoraeDB nodes to achieve load balance or failover. However, the dynamic topology can be enabled only if the storage used by the HoraeDB node is remote, otherwise the data may be corrupted when tables are transferred to a different HoraeDB node when the data of HoraeDB is persisted locally.</p>
<p>Currently, the dynamic scheduling over the cluster topology is disabled by default in HoraeMeta, and in this guide, we won't enable it because local storage is adopted here. If you want to enable the dynamic scheduling, the <code>TOPOLOGY_TYPE</code> can be set as <code>dynamic</code> (<code>static</code> by default), and after that, load balancing and failover will work. However, don't enable it if what the underlying storage is local disk.</p>
<p>With the static topology, the params <code>DEFAULT_CLUSTER_NODE_COUNT</code>, which denotes the number of the HoraeDB nodes in the deployed cluster and should be set to the real number of machines for HoraeDB server, matters a lot because after cluster initialization the HoraeDB nodes can't be changed any more.</p>
<h4 id="start-horaemeta-instances"><a class="header" href="#start-horaemeta-instances">Start HoraeMeta Instances</a></h4>
<p>HoraeMeta is based on etcd to achieve high availability. In product environment, we usually deploy multiple nodes, but in local environment and testing, we can directly deploy a single node to simplify the entire deployment process.</p>
<ul>
<li>Standalone</li>
</ul>
<pre><code class="language-bash">docker run -d --name horaemeta-server \
  -p 2379:2379 \
  ghcr.io/apache/horaemeta-server:nightly-20231225-ab067bf0
</code></pre>
<ul>
<li>Cluster</li>
</ul>
<pre><code class="language-bash">wget https://raw.githubusercontent.com/apache/incubator-horaedb-docs/main/docs/src/resources/config-horaemeta-cluster0.toml

docker run -d --network=host --name horaemeta-server0 \
  -v $(pwd)/config-horaemeta-cluster0.toml:/etc/horaemeta/horaemeta.toml \
  ghcr.io/apache/horaemeta-server:nightly-20231225-ab067bf0

wget https://raw.githubusercontent.com/apache/incubator-horaedb-docs/main/docs/src/resources/config-horaemeta-cluster1.toml

docker run -d --network=host --name horaemeta-server1 \
  -v $(pwd)/config-horaemeta-cluster1.toml:/etc/horaemeta/horaemeta.toml \
  ghcr.io/apache/horaemeta-server:nightly-20231225-ab067bf0

wget https://raw.githubusercontent.com/apache/incubator-horaedb-docs/main/docs/src/resources/config-horaemeta-cluster2.toml

docker run -d --network=host --name horaemeta-server2 \
  -v $(pwd)/config-horaemeta-cluster2.toml:/etc/horaemeta/horaemeta.toml \
  ghcr.io/apache/horaemeta-server:nightly-20231225-ab067bf0
</code></pre>
<p>And if the storage used by the HoraeDB is remote and you want to enable the dynamic schedule features of the HoraeDB cluster, the <code>-e TOPOLOGY_TYPE=dynamic</code> can be added to the docker run command.</p>
<h2 id="deploy-horaedb"><a class="header" href="#deploy-horaedb">Deploy HoraeDB</a></h2>
<p>In the <code>NoMeta</code> mode, HoraeDB only requires the local disk as the underlying storage because the topology of the HoraeDB cluster is static. However, with HoraeMeta, the cluster topology can be dynamic, that is to say, HoraeDB can be configured to use a non-local storage service for the features of a distributed system: HA, load balancing, scalability and so on. And HoraeDB can be still configured to use a local storage with HoraeMeta, which certainly leads to a static cluster topology.</p>
<p>The relevant storage configurations include two parts:</p>
<ul>
<li>Object Storage</li>
<li>WAL Storage</li>
</ul>
<p>Note: If you are deploying HoraeDB over multiple nodes in a production environment, please set the environment variable for the server address as follows:</p>
<pre><code class="language-shell">export HORAEDB_SERVER_ADDR=&quot;{server_address}:8831&quot;
</code></pre>
<p>This address is used for communication between HoraeMeta and HoraeDB, please ensure it is valid.</p>
<h3 id="object-storage"><a class="header" href="#object-storage">Object Storage</a></h3>
<h4 id="local-storage"><a class="header" href="#local-storage">Local Storage</a></h4>
<p>Similarly, we can configure HoraeDB to use a local disk as the underlying storage:</p>
<pre><code class="language-toml">[analytic.storage.object_store]
type = &quot;Local&quot;
data_dir = &quot;/home/admin/data/horaedb&quot;
</code></pre>
<h4 id="oss"><a class="header" href="#oss">OSS</a></h4>
<p>Aliyun OSS can be also used as the underlying storage for HoraeDB, with which the data is replicated for disaster recovery. Here is a example config, and you have to replace the templates with the real OSS parameters:</p>
<pre><code class="language-toml">[analytic.storage.object_store]
type = &quot;Aliyun&quot;
key_id = &quot;{key_id}&quot;
key_secret = &quot;{key_secret}&quot;
endpoint = &quot;{endpoint}&quot;
bucket = &quot;{bucket}&quot;
prefix = &quot;{data_dir}&quot;
</code></pre>
<h4 id="s3"><a class="header" href="#s3">S3</a></h4>
<p>Amazon S3 can be also used as the underlying storage for HoraeDB. Here is a example config, and you have to replace the templates with the real S3 parameters:</p>
<pre><code class="language-toml">[analytic.storage.object_store]
type = &quot;S3&quot;
region = &quot;{region}&quot;
key_id = &quot;{key_id}&quot;
key_secret = &quot;{key_secret}&quot;
endpoint = &quot;{endpoint}&quot;
bucket = &quot;{bucket}&quot;
prefix = &quot;{prefix}&quot;
</code></pre>
<h3 id="wal-storage"><a class="header" href="#wal-storage">WAL Storage</a></h3>
<h4 id="rocksdb"><a class="header" href="#rocksdb">RocksDB</a></h4>
<p>The WAL based on RocksDB is also a kind of local storage for HoraeDB, which is easy for a quick start:</p>
<pre><code class="language-toml">[analytic.wal]
type = &quot;RocksDB&quot;
data_dir = &quot;/home/admin/data/horaedb&quot;
</code></pre>
<h4 id="oceanbase"><a class="header" href="#oceanbase">OceanBase</a></h4>
<p>If you have deployed a OceanBase cluster, HoraeDB can use it as the WAL storage for data disaster recovery. Here is a example config for such WAL, and you have to replace the templates with real OceanBase parameters:</p>
<pre><code class="language-toml">[analytic.wal]
type = &quot;Obkv&quot;

[analytic.wal.data_namespace]
ttl = &quot;365d&quot;

[analytic.wal.obkv]
full_user_name = &quot;{full_user_name}&quot;
param_url = &quot;{param_url}&quot;
password = &quot;{password}&quot;

[analytic.wal.obkv.client]
sys_user_name = &quot;{sys_user_name}&quot;
sys_password = &quot;{sys_password}&quot;
</code></pre>
<h4 id="kafka"><a class="header" href="#kafka">Kafka</a></h4>
<p>If you have deployed a Kafka cluster, HoraeDB can also use it as the WAL storage. Here is example config for it, and you have to replace the templates with real parameters of the Kafka cluster:</p>
<pre><code class="language-toml">[analytic.wal]
type = &quot;Kafka&quot;

[analytic.wal.kafka.client]
boost_broker = &quot;{boost_broker}&quot;
</code></pre>
<h3 id="meta-client-config"><a class="header" href="#meta-client-config">Meta Client Config</a></h3>
<p>Besides the storage configurations, HoraeDB must be configured to start in <code>WithMeta</code> mode and connect to the deployed HoraeMeta:</p>
<pre><code class="language-toml">[cluster_deployment]
mode = &quot;WithMeta&quot;

[cluster_deployment.meta_client]
cluster_name = 'defaultCluster'
meta_addr = 'http://{HoraeMetaAddr}:2379'
lease = &quot;10s&quot;
timeout = &quot;5s&quot;

[cluster_deployment.etcd_client]
server_addrs = ['http://{HoraeMetaAddr}:2379']
</code></pre>
<h3 id="complete-config-of-horaedb"><a class="header" href="#complete-config-of-horaedb">Complete Config of HoraeDB</a></h3>
<p>With all the parts of the configurations mentioned above, a runnable complete config for HoraeDB can be made. In order to make the HoraeDB cluster runnable, we can decide to adopt RocksDB-based WAL and local-disk-based Object Storage:</p>
<pre><code class="language-toml">[server]
bind_addr = &quot;0.0.0.0&quot;
http_port = 5440
grpc_port = 8831

[logger]
level = &quot;info&quot;

[runtime]
read_thread_num = 20
write_thread_num = 16
background_thread_num = 12

[cluster_deployment]
mode = &quot;WithMeta&quot;

[cluster_deployment.meta_client]
cluster_name = 'defaultCluster'
meta_addr = 'http://127.0.0.1:2379'
lease = &quot;10s&quot;
timeout = &quot;5s&quot;

[cluster_deployment.etcd_client]
server_addrs = ['127.0.0.1:2379']

[analytic]
write_group_worker_num = 16
replay_batch_size = 100
max_replay_tables_per_batch = 128
write_group_command_channel_cap = 1024
sst_background_read_parallelism = 8

[analytic.manifest]
scan_batch_size = 100
snapshot_every_n_updates = 10000
scan_timeout = &quot;5s&quot;
store_timeout = &quot;5s&quot;

[analytic.wal]
type = &quot;RocksDB&quot;
data_dir = &quot;/home/admin/data/horaedb&quot;

[analytic.storage]
mem_cache_capacity = &quot;20GB&quot;
# 1&lt;&lt;8=256
mem_cache_partition_bits = 8

[analytic.storage.object_store]
type = &quot;Local&quot;
data_dir = &quot;/home/admin/data/horaedb/&quot;

[analytic.table_opts]
arena_block_size = 2097152
write_buffer_size = 33554432

[analytic.compaction]
schedule_channel_len = 16
schedule_interval = &quot;30m&quot;
max_ongoing_tasks = 8
memory_limit = &quot;4G&quot;
</code></pre>
<p>Let's name this config file as <code>config.toml</code>. And the example configs, in which the templates must be replaced with real parameters before use, for remote storages are also provided:</p>
<ul>
<li><a href="../resources/config_local_oss.toml">RocksDB WAL + OSS</a></li>
<li><a href="../resources/config_obkv_oss.toml">OceanBase WAL + OSS</a></li>
<li><a href="../resources/config_kafka_oss.toml">Kafka WAL + OSS</a></li>
</ul>
<h2 id="run-horaedb-cluster-with-horaemeta"><a class="header" href="#run-horaedb-cluster-with-horaemeta">Run HoraeDB cluster with HoraeMeta</a></h2>
<p>Firstly, let's start the HoraeMeta:</p>
<pre><code class="language-bash">docker run -d --name horaemeta-server \
  -p 2379:2379 \
  ghcr.io/apache/horaemeta-server:nightly-20231225-ab067bf0
</code></pre>
<p>With the started HoraeMeta cluster, let's start the HoraeDB instance:
TODO: complete it later</p>

                </main>

                <nav class="nav-wrapper" aria-label="Page navigation">
                    <!-- Mobile navigation buttons -->
                    <a rel="prev" href="../cluster_deployment/no_meta.html" class="mobile-nav-chapters previous"
                        title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../sdk/README.html" class="mobile-nav-chapters next"
                        title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>

                    <div style="clear: both"></div>
                </nav>
            </div>
        </div>

        <nav class="nav-wide-wrapper" aria-label="Page navigation">
            <a rel="prev" href="../cluster_deployment/no_meta.html" class="nav-chapters previous" title="Previous chapter"
                aria-label="Previous chapter" aria-keyshortcuts="Left">
                <i class="fa fa-angle-left"></i>
            </a>

            <a rel="next" href="../sdk/README.html" class="nav-chapters next" title="Next chapter"
                aria-label="Next chapter" aria-keyshortcuts="Right">
                <i class="fa fa-angle-right"></i>
            </a>
        </nav>

    </div>




    <script>
        window.playground_copyable = true;
    </script>


    <script src="../elasticlunr.min.js" charset="utf-8"></script>
    <script src="../mark.min.js" charset="utf-8"></script>
    <script src="../searcher.js" charset="utf-8"></script>

    <script src="../clipboard.min.js" charset="utf-8"></script>
    <script src="../highlight.js" charset="utf-8"></script>
    <script src="../book.js" charset="utf-8"></script>

    <!-- Custom JS scripts -->
    <script src="../sidebar.js"></script>


    <script type="text/javascript">
        let langs = [
            'cn',
            'en'
        ];

        (function langs() {
            var html = document.querySelector('html');
            var langToggleButton = document.getElementById('lang-toggle');
            var langPopup = document.getElementById('lang-list');

            function showLangs() {
                langPopup.style.display = 'block';
                langToggleButton.setAttribute('aria-expanded', true);
            }

            function hideLangs() {
                langPopup.style.display = 'none';
                langToggleButton.setAttribute('aria-expanded', false);
                langToggleButton.focus();
            }

            langToggleButton.addEventListener('click', function () {
                if (langPopup.style.display === 'block') {
                    hideLangs();
                } else {
                    showLangs();
                }
            });

            langPopup.addEventListener('click', function (e) {
                let langs = [
                    'cn',
                    'en'
                ];
                var lang = e.target.id || e.target.parentElement.id;
                var path_list = [];
                window.location.pathname.split('/').map((s, idx) => {
                    // FIXME: This is hard code to address the i18n problem, and it requires the base path must include two path elements.
                    if (idx == 2) {
                        if (!langs.includes(s)) {
                            path_list.push(lang);
                            path_list.push(s);
                        } else {
                            path_list.push(lang);
                        }
                    } else {
                        path_list.push(s);
                    }
                });
                console.log("path:");
                window.location.pathname = path_list.join('/');
            });

            langPopup.addEventListener('focusout', function (e) {
                // e.relatedTarget is null in Safari and Firefox on macOS (see workaround below)
                if (!!e.relatedTarget && !langToggleButton.contains(e.relatedTarget) && !langPopup.contains(e.relatedTarget)) {
                    hideLangs();
                }
            });

            // Should not be needed, but it works around an issue on macOS & iOS: https://github.com/rust-lang-nursery/mdBook/issues/628
            document.addEventListener('click', function (e) {
                if (langPopup.style.display === 'block' && !langToggleButton.contains(e.target) && !langPopup.contains(e.target)) {
                    hideLangs();
                }
            });

        })();
    </script>


</body>

</html>